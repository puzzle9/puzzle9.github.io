<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>puzzle9 blog</title>
  
  <subtitle>I exist because you need me.</subtitle>
  <link href="https://puzzle9.github.io/atom.xml" rel="self"/>
  
  <link href="https://puzzle9.github.io/"/>
  <updated>2025-07-13T09:25:47.893Z</updated>
  <id>https://puzzle9.github.io/</id>
  
  <author>
    <name>puzzle9</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>airflow</title>
    <link href="https://puzzle9.github.io/posts/6fc07c7e/"/>
    <id>https://puzzle9.github.io/posts/6fc07c7e/</id>
    <published>2025-07-11T06:23:09.000Z</published>
    <updated>2025-07-13T09:25:47.893Z</updated>
    
    <content type="html"><![CDATA[<p>一款优秀的 调度工具</p><h1 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h1><p>现有版本用的 <a href="https://github.com/pentaho/pentaho-kettle"><code>kattle</code></a><br>因为是图像界面操作 再者 不好做版本控制<br>便把目光转向了 <a href="https://github.com/apache/airflow"><code>airflow</code></a></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>用 <code>docker</code> 呀</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.oracle.com/otn_software/linux/instantclient/2380000/instantclient-basic-linux.x64-23.8.0.25.04.zip</span><br><span class="line">unzip instantclient-basic-linux.x64-23.8.0.25.04.zip</span><br></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> apache/airflow:<span class="number">3.0</span>.<span class="number">2</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i <span class="string">&#x27;s#http://deb.debian.org#https://mirror.nju.edu.cn#g&#x27;</span> /etc/apt/sources.list.d/debian.sources \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; apt-get install -y --no-install-recommends \</span></span><br><span class="line"><span class="language-bash">        libaio1 \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; apt-get autoremove -yqq --purge \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; apt-get clean \</span></span><br><span class="line"><span class="language-bash">  &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./instantclient_23_8 /opt/oracle_instantclient_23_8</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> /opt/oracle_instantclient_23_8 &gt; /etc/ld.so.conf.d/oracle_instantclient.conf &amp;&amp; ldconfig</span></span><br><span class="line"><span class="keyword">USER</span> airflow</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --proxy http://172.17.0.1:8889 -i https://mirror.nju.edu.cn/pypi/web/simple --no-cache-dir \</span></span><br><span class="line"><span class="language-bash">    <span class="string">&quot;apache-airflow==3.0.2&quot;</span> \</span></span><br><span class="line"><span class="language-bash">    apache-airflow[mysql] \</span></span><br><span class="line"><span class="language-bash">    apache-airflow[microsoft-mssql] \</span></span><br><span class="line"><span class="language-bash">    apache-airflow[odbc] \</span></span><br><span class="line"><span class="language-bash">    apache-airflow[oracle] \</span></span><br><span class="line"><span class="language-bash">    apache-airflow[postgres] \</span></span><br><span class="line"><span class="language-bash">    apache-airflow[redis] \</span></span><br><span class="line"><span class="language-bash">    apache-airflow[samba] \</span></span><br><span class="line"><span class="language-bash">    apache-airflow[http]</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t puzzle9/airflow:3.0.2 .</span><br><span class="line"></span><br><span class="line"><span class="comment">#docker build -t puzzle9/airflow:3.0.2 --build-arg http_proxy=&quot;http://192.168.1.1:8888&quot; --build-arg https_proxy=&quot;http://192.168.1.1:8888&quot; .</span></span><br></pre></td></tr></table></figure><p>好了 基础镜像就出来了</p><p>再来个 <code>docker-compose.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://airflow.apache.org/docs/apache-airflow/3.0.2/docker-compose.yaml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">x-airflow-common:</span> <span class="string">&amp;airflow-common</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">puzzle9/airflow:3.0.2</span></span><br><span class="line">  <span class="comment"># build: .</span></span><br><span class="line">  <span class="attr">environment:</span> <span class="string">&amp;airflow-common-env</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__DEFAULT_TIMEZONE:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">    <span class="attr">AIRFLOW__SCHEDULER__SCHEDULER_HEARTBEAT_SEC:</span> <span class="string">$&#123;AIRFLOW_SCHEDULER_HEARTBEAT_SEC&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW__DAG_PROCESSOR__MIN_FILE_PROCESS_INTERVAL:</span> <span class="string">$&#123;AIRFLOW_MIN_FILE_PROCESS_INTERVAL&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__PARALLELISM:</span> <span class="string">$&#123;AIRFLOW_PARALLELISM&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG:</span> <span class="string">$&#123;AIRFLOW_MAX_ACTIVE_RUNS_PER_DAG&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__EXECUTOR:</span> <span class="string">$&#123;AIRFLOW_EXECUTOR&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__AUTH_MANAGER:</span> <span class="string">airflow.providers.fab.auth_manager.fab_auth_manager.FabAuthManager</span></span><br><span class="line">    <span class="attr">AIRFLOW__DAG_PROCESSOR__DISABLE_BUNDLE_VERSIONING:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="attr">AIRFLOW__DATABASE__SQL_ALCHEMY_CONN:</span> <span class="string">postgresql+psycopg2://$&#123;POSTGRES_USERNAME&#125;:$&#123;POSTGRES_PASSWORD&#125;@$&#123;POSTGRES_HOST&#125;:$&#123;POSTGRES_PORT:-5432&#125;/$&#123;POSTGRES_DATABASE&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CELERY__RESULT_BACKEND:</span> <span class="string">db+postgresql://$&#123;POSTGRES_USERNAME&#125;:$&#123;POSTGRES_PASSWORD&#125;@$&#123;POSTGRES_HOST&#125;:$&#123;POSTGRES_PORT:-5432&#125;/$&#123;POSTGRES_DATABASE&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CELERY__BROKER_URL:</span> <span class="string">redis://:$&#123;VALKEY_PASSWORD&#125;@$&#123;VALKEY_HOST&#125;:$&#123;VALKEY_PORT:-6379&#125;/$&#123;VALKEY_DATABASE:-0&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__FERNET_KEY:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__LOAD_EXAMPLES:</span> <span class="string">&#x27;false&#x27;</span></span><br><span class="line">    <span class="attr">AIRFLOW__CORE__EXECUTION_API_SERVER_URL:</span> <span class="string">&#x27;http://airflow-apiserver:8080/execution/&#x27;</span></span><br><span class="line">    <span class="attr">AIRFLOW__SCHEDULER__ENABLE_HEALTH_CHECK:</span> <span class="string">&#x27;false&#x27;</span></span><br><span class="line">    <span class="attr">_PIP_ADDITIONAL_REQUIREMENTS:</span> <span class="string">$&#123;_PIP_ADDITIONAL_REQUIREMENTS:-&#125;</span></span><br><span class="line">    <span class="attr">AIRFLOW_CONFIG:</span> <span class="string">&#x27;/opt/airflow/config/airflow.cfg&#x27;</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./data/dags:/opt/airflow/dags</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./data/logs:/opt/airflow/logs</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./data/config:/opt/airflow/config</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">./data/plugins:/opt/airflow/plugins</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/etc/localtime:/etc/localtime:ro</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/etc/timezone:/etc/timezone:ro</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">&#x27;$&#123;AIRFLOW_UID:-50000&#125;:0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">airflow-apiserver:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="string">*airflow-common</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">api-server</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;8080:8080&#x27;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">airflow-scheduler:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="string">*airflow-common</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">scheduler</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">airflow-dag-processor:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="string">*airflow-common</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">dag-processor</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">airflow-triggerer:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="string">*airflow-common</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">triggerer</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">airflow-worker:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="string">*airflow-common</span></span><br><span class="line">    <span class="attr">profiles:</span> [<span class="string">&#x27;airflow-worker&#x27;</span>]</span><br><span class="line">    <span class="attr">command:</span> <span class="string">celery</span> <span class="string">worker</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="comment"># yamllint disable rule:line-length</span></span><br><span class="line">      <span class="attr">test:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;CMD-SHELL&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&#x27;celery --app airflow.providers.celery.executors.celery_executor.app inspect ping -d &quot;celery@$$&#123;HOSTNAME&#125;&quot; || celery --app airflow.executors.celery_executor.app inspect ping -d &quot;celery@$$&#123;HOSTNAME&#125;&quot;&#x27;</span></span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="string">*airflow-common-env</span></span><br><span class="line">      <span class="comment"># Required to handle warm shutdown of the celery workers properly</span></span><br><span class="line">      <span class="comment"># See https://airflow.apache.org/docs/docker-stack/entrypoint.html#signal-propagation</span></span><br><span class="line">      <span class="attr">DUMB_INIT_SETSID:</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">airflow-init:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="string">*airflow-common</span></span><br><span class="line">    <span class="attr">profiles:</span> [<span class="string">&#x27;airflow-init&#x27;</span>]</span><br><span class="line">    <span class="attr">entrypoint:</span> <span class="string">/bin/bash</span></span><br><span class="line">    <span class="comment"># yamllint disable rule:line-length</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line"><span class="string">        if [[ -z &quot;$&#123;AIRFLOW_UID&#125;&quot; ]]; then</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          echo -e &quot;\033[1;33mWARNING!!!: AIRFLOW_UID not set!\e[0m&quot;</span></span><br><span class="line"><span class="string">          echo &quot;If you are on Linux, you SHOULD follow the instructions below to set &quot;</span></span><br><span class="line"><span class="string">          echo &quot;AIRFLOW_UID environment variable, otherwise files will be owned by root.&quot;</span></span><br><span class="line"><span class="string">          echo &quot;For other operating systems you can get rid of the warning with manually created .env file:&quot;</span></span><br><span class="line"><span class="string">          echo &quot;    See: https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html#setting-the-right-airflow-user&quot;</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          export AIRFLOW_UID=$(id -u)</span></span><br><span class="line"><span class="string">        fi</span></span><br><span class="line"><span class="string">        one_meg=1048576</span></span><br><span class="line"><span class="string">        mem_available=$$(($$(getconf _PHYS_PAGES) * $$(getconf PAGE_SIZE) / one_meg))</span></span><br><span class="line"><span class="string">        cpus_available=$$(grep -cE &#x27;cpu[0-9]+&#x27; /proc/stat)</span></span><br><span class="line"><span class="string">        disk_available=$$(df / | tail -1 | awk &#x27;&#123;print $$4&#125;&#x27;)</span></span><br><span class="line"><span class="string">        warning_resources=&quot;false&quot;</span></span><br><span class="line"><span class="string">        if (( mem_available &lt; 4000 )) ; then</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          echo -e &quot;\033[1;33mWARNING!!!: Not enough memory available for Docker.\e[0m&quot;</span></span><br><span class="line"><span class="string">          echo &quot;At least 4GB of memory required. You have $$(numfmt --to iec $$((mem_available * one_meg)))&quot;</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          warning_resources=&quot;true&quot;</span></span><br><span class="line"><span class="string">        fi</span></span><br><span class="line"><span class="string">        if (( cpus_available &lt; 2 )); then</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          echo -e &quot;\033[1;33mWARNING!!!: Not enough CPUS available for Docker.\e[0m&quot;</span></span><br><span class="line"><span class="string">          echo &quot;At least 2 CPUs recommended. You have $$&#123;cpus_available&#125;&quot;</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          warning_resources=&quot;true&quot;</span></span><br><span class="line"><span class="string">        fi</span></span><br><span class="line"><span class="string">        if (( disk_available &lt; one_meg * 10 )); then</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          echo -e &quot;\033[1;33mWARNING!!!: Not enough Disk space available for Docker.\e[0m&quot;</span></span><br><span class="line"><span class="string">          echo &quot;At least 10 GBs recommended. You have $$(numfmt --to iec $$((disk_available * 1024 )))&quot;</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          warning_resources=&quot;true&quot;</span></span><br><span class="line"><span class="string">        fi</span></span><br><span class="line"><span class="string">        if [[ $$&#123;warning_resources&#125; == &quot;true&quot; ]]; then</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">          echo -e &quot;\033[1;33mWARNING!!!: You have not enough resources to run Airflow (see above)!\e[0m&quot;</span></span><br><span class="line"><span class="string">          echo &quot;Please follow the instructions to increase amount of resources available:&quot;</span></span><br><span class="line"><span class="string">          echo &quot;   https://airflow.apache.org/docs/apache-airflow/stable/howto/docker-compose/index.html#before-you-begin&quot;</span></span><br><span class="line"><span class="string">          echo</span></span><br><span class="line"><span class="string">        fi</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        echo &quot;Creating missing opt dirs if missing:&quot;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        mkdir -v -p /opt/airflow/&#123;logs,dags,plugins,config&#125;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        echo &quot;Airflow version:&quot;</span></span><br><span class="line"><span class="string">        /entrypoint airflow version</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        echo &quot;Files in shared volumes:&quot;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        ls -la /opt/airflow/&#123;logs,dags,plugins,config&#125;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        echo &quot;Running airflow config list to create default config file if missing.&quot;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        /entrypoint airflow config list &gt;/dev/null</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        echo &quot;Files in shared volumes:&quot;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        ls -la /opt/airflow/&#123;logs,dags,plugins,config&#125;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        echo &quot;Change ownership of files in /opt/airflow to $&#123;AIRFLOW_UID&#125;:0&quot;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        chown -R &quot;$&#123;AIRFLOW_UID&#125;:0&quot; /opt/airflow/</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        echo &quot;Change ownership of files in shared volumes to $&#123;AIRFLOW_UID&#125;:0&quot;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        chown -v -R &quot;$&#123;AIRFLOW_UID&#125;:0&quot; /opt/airflow/&#123;logs,dags,plugins,config&#125;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        echo &quot;Files in shared volumes:&quot;</span></span><br><span class="line"><span class="string">        echo</span></span><br><span class="line"><span class="string">        ls -la /opt/airflow/&#123;logs,dags,plugins,config&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="comment"># yamllint enable rule:line-length</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="string">&lt;&lt;:</span> <span class="string">*airflow-common-env</span></span><br><span class="line">      <span class="attr">_AIRFLOW_DB_MIGRATE:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">      <span class="attr">_AIRFLOW_WWW_USER_CREATE:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">      <span class="attr">_AIRFLOW_WWW_USER_USERNAME:</span> <span class="string">$&#123;_AIRFLOW_WWW_USER_USERNAME:-airflow&#125;</span></span><br><span class="line">      <span class="attr">_AIRFLOW_WWW_USER_PASSWORD:</span> <span class="string">$&#123;_AIRFLOW_WWW_USER_PASSWORD:-airflow&#125;</span></span><br><span class="line">      <span class="attr">_PIP_ADDITIONAL_REQUIREMENTS:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">&#x27;0:0&#x27;</span></span><br></pre></td></tr></table></figure><p>用的是 <code>LocalExecutor</code> 模式部署的<br>所以把 <code>healthcheck</code> 也都去掉了</p><p>后端的 <code>postgresql</code> <code>redis</code> 独立部署的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># airflow</span><br><span class="line"># echo $(id -u)</span><br><span class="line">AIRFLOW_UID=1000</span><br><span class="line">AIRFLOW_SCHEDULER_HEARTBEAT_SEC=30</span><br><span class="line"># 刷新dag文件秒数 正式环境改为600</span><br><span class="line">AIRFLOW_MIN_FILE_PROCESS_INTERVAL=60</span><br><span class="line">AIRFLOW_PARALLELISM=18</span><br><span class="line">AIRFLOW_MAX_ACTIVE_RUNS_PER_DAG=16</span><br><span class="line">AIRFLOW_EXECUTOR=LocalExecutor</span><br><span class="line"></span><br><span class="line"># postgres</span><br><span class="line">POSTGRES_HOST=172.17.0.1</span><br><span class="line">POSTGRES_USERNAME=postgres</span><br><span class="line">POSTGRES_PASSWORD=postgres</span><br><span class="line">POSTGRES_DATABASE=airflow</span><br><span class="line"></span><br><span class="line"># valkey</span><br><span class="line">VALKEY_HOST=172.17.0.1</span><br><span class="line">VALKEY_PASSWORD=valkey</span><br></pre></td></tr></table></figure><p>先 <code>docker compose up airflow-init</code> 初始化<br>再 <code>docker compose up -d</code> 一键启动</p><h1 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><h2 id="dag-不会出来"><a href="#dag-不会出来" class="headerlink" title="dag 不会出来"></a><code>dag</code> 不会出来</h2><p>需要给 <code>执行</code> 权限 <code>chmod +x data/dags/*.py</code></p><h2 id="mssql-相关"><a href="#mssql-相关" class="headerlink" title="mssql 相关"></a>mssql 相关</h2><h3 id="mssql-连接时候报-DB-Lib-error-message-20002"><a href="#mssql-连接时候报-DB-Lib-error-message-20002" class="headerlink" title="mssql 连接时候报 DB-Lib error message 20002"></a>mssql 连接时候报 <code>DB-Lib error message 20002</code></h3><p>用这个解决</p><ul><li><a href="https://github.com/pymssql/pymssql/issues/896">https://github.com/pymssql/pymssql/issues/896</a></li></ul><p>再 <code>connections</code> 时 <code>Extra Fields JSON</code> 中加入 <code>&#123;&quot;tds_version&quot;: &quot;7.0&quot;&#125;</code></p><h2 id="oracle-相关"><a href="#oracle-相关" class="headerlink" title="oracle 相关"></a>oracle 相关</h2><ul><li><a href="https://airflow.apache.org/docs/apache-airflow-providers-oracle/stable/connections/oracle.html">https://airflow.apache.org/docs/apache-airflow-providers-oracle/stable/connections/oracle.html</a></li><li><a href="https://python-oracledb.readthedocs.io/en/latest/user_guide/installation.html">https://python-oracledb.readthedocs.io/en/latest/user_guide/installation.html</a></li></ul><h3 id="DPY-4027-no-configuration-directory-specified"><a href="#DPY-4027-no-configuration-directory-specified" class="headerlink" title="DPY-4027: no configuration directory specified"></a><code>DPY-4027: no configuration directory specified</code></h3><p>再 <code>connections</code> 时 <code>Extra Fields JSON</code> 中加入 <code>&#123;&quot;service_name&quot;: &quot;orcl&quot;&#125;</code></p><h3 id="DPY-3015-password-verifier-type-0x939-is-not-supported-by-python-oracledb-in-thin-mode"><a href="#DPY-3015-password-verifier-type-0x939-is-not-supported-by-python-oracledb-in-thin-mode" class="headerlink" title="DPY-3015: password verifier type 0x939 is not supported by python-oracledb in thin mode"></a><code>DPY-3015: password verifier type 0x939 is not supported by python-oracledb in thin mode</code></h3><p>再 <code>connections</code> 时 <code>Extra Fields JSON</code> 中加入 <code>&#123;&quot;thick_mode&quot;: true, &quot;thick_mode_lib_dir&quot;: &quot;/opt/oracle_instantclient_23_8&quot;&#125;</code></p><h3 id="ORA-28726-set-current-schema-operation-failed-because-the-given-schema-name-is-either-invalid-or-does-not-exist"><a href="#ORA-28726-set-current-schema-operation-failed-because-the-given-schema-name-is-either-invalid-or-does-not-exist" class="headerlink" title="ORA-28726: set current schema operation failed because the given schema name is either invalid or does not exist"></a><code>ORA-28726: set current schema operation failed because the given schema name is either invalid or does not exist</code></h3><p>修改 <code>Schema</code> 为 库名</p><h2 id="如何本地化运行"><a href="#如何本地化运行" class="headerlink" title="如何本地化运行"></a>如何本地化运行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name <span class="string">&quot;airflow&quot;</span> -d -p 8080:8080 --<span class="built_in">env</span> <span class="string">&quot;_AIRFLOW_DB_MIGRATE=true&quot;</span> --<span class="built_in">env</span> <span class="string">&quot;_AIRFLOW_WWW_USER_CREATE=true&quot;</span> --<span class="built_in">env</span> <span class="string">&quot;_AIRFLOW_WWW_USER_PASSWORD=admin&quot;</span> -v ./data/dags:/opt/airflow/dags apache/airflow:3.0.2 airflow standalone</span><br></pre></td></tr></table></figure><h2 id="如何删除dag历史记录"><a href="#如何删除dag历史记录" class="headerlink" title="如何删除dag历史记录"></a>如何删除<code>dag</code>历史记录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除指定的</span></span><br><span class="line">airflow dags delete -v [dag_id]</span><br><span class="line">airflow tasks clear -v [dag_id]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除全部的</span></span><br><span class="line">airflow db clean --skip-archive --clean-before-timestamp <span class="string">&#x27;2020-01-01 00:00:00+01:00&#x27;</span> -y</span><br></pre></td></tr></table></figure><h2 id="超时相关"><a href="#超时相关" class="headerlink" title="超时相关"></a>超时相关</h2><p>运行模式有 <code>LocalExecutor</code> 和 <code>CeleryExecutor</code> 两种</p><p>都用的 <code>orphaned_tasks_check_interval</code> 和 <code>task_instance_heartbeat_timeout</code> 作为默认时间<br>也都用 <code>parallelism</code> 作为 <code>work</code> 数量</p><p>在 <code>CeleryExecutor</code> 中 可以用 <code>execution_timeout</code> 定义超时时间 部署时需要启用 <code>airflow-worker</code><br>在 <code>LocalExecutor</code> 中 开始时间为 <code>入队时间</code></p><p>心跳 在 <code>3.0.2</code> 好像有点问题 不会自己更新</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">from airflow import DAG</span><br><span class="line">from airflow.decorators import task</span><br><span class="line">from datetime import datetime, timedelta</span><br><span class="line"></span><br><span class="line">with DAG(</span><br><span class="line">        dag_id=&#x27;test_timeouta2&#x27;,</span><br><span class="line">        schedule=&#x27;@once&#x27;,</span><br><span class="line">        start_date=datetime(2025, 7, 10),</span><br><span class="line">        default_args=&#123;</span><br><span class="line">            &quot;execution_timeout&quot;: timedelta(seconds=86),</span><br><span class="line">        &#125;,</span><br><span class="line">) as dag:</span><br><span class="line">    @task</span><br><span class="line">    def start():</span><br><span class="line">        print(&quot;start&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @task</span><br><span class="line">    def sleep_dag_600():</span><br><span class="line">        print(&quot;start sleep 600&quot;)</span><br><span class="line">        time.sleep(600)</span><br><span class="line">        print(&quot;sleep 600 ok&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @task(execution_timeout=timedelta(seconds=96))</span><br><span class="line">    def sleep_dag_95():</span><br><span class="line">        print(&quot;start sleep 95&quot;)</span><br><span class="line">        time.sleep(95)</span><br><span class="line">        print(&quot;sleep 95 ok&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @task</span><br><span class="line">    def sleep_dag_90():</span><br><span class="line">        print(&quot;start sleep 90&quot;)</span><br><span class="line">        time.sleep(90)</span><br><span class="line">        print(&quot;sleep 90 ok&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @task</span><br><span class="line">    def sleep_dag_85():</span><br><span class="line">        print(&quot;start sleep 85&quot;)</span><br><span class="line">        time.sleep(85)</span><br><span class="line">        print(&quot;sleep 85 ok&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @task</span><br><span class="line">    def sleep_dag_60():</span><br><span class="line">        print(&quot;start sleep 60&quot;)</span><br><span class="line">        time.sleep(60)</span><br><span class="line">        print(&quot;sleep 60 ok&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @task(execution_timeout=timedelta(seconds=30))</span><br><span class="line">    def sleep_dag_30():</span><br><span class="line">        print(&quot;start sleep 30&quot;)</span><br><span class="line">        time.sleep(30)</span><br><span class="line">        print(&quot;sleep 30 ok&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @task</span><br><span class="line">    def sleep_dag_6():</span><br><span class="line">        print(&quot;start sleep 6&quot;)</span><br><span class="line">        time.sleep(6)</span><br><span class="line">        print(&quot;sleep 6 ok&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    start() &gt;&gt; [</span><br><span class="line">        sleep_dag_600(),</span><br><span class="line">        sleep_dag_95(),</span><br><span class="line">        sleep_dag_90(),</span><br><span class="line">        sleep_dag_85(),</span><br><span class="line">        sleep_dag_60(),</span><br><span class="line">        sleep_dag_30(),</span><br><span class="line">        sleep_dag_6(),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><h1 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h1><ul><li><a href="https://www.echo.cool/docs/data/airflow/">https://www.echo.cool/docs/data/airflow/</a></li><li><a href="https://gist.github.com/worbas/c2e6d99d4fecc7cef506d90fa012d5b9">https://gist.github.com/worbas/c2e6d99d4fecc7cef506d90fa012d5b9</a></li></ul>]]></content>
    
    
    <summary type="html">airflow3 的使用吧</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>mysql 迁移到 mssql</title>
    <link href="https://puzzle9.github.io/posts/85b64b8/"/>
    <id>https://puzzle9.github.io/posts/85b64b8/</id>
    <published>2025-07-02T13:15:06.000Z</published>
    <updated>2025-07-02T13:34:19.828Z</updated>
    
    <content type="html"><![CDATA[<p>所以 为什么会有这种需求</p><h1 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h1><p>有官方工具 也有第三方的</p><p>但是 无一例外 都不支持迁移<code>表</code>和<code>字段</code><strong>注释</strong></p><h2 id="navicat"><a href="#navicat" class="headerlink" title="navicat"></a><a href="https://www.navicat.com/">navicat</a></h2><p>这个 可以使用 导出表结构 导入表结构处理</p><h2 id="dbconvert-studio"><a href="#dbconvert-studio" class="headerlink" title="dbconvert_studio"></a><a href="https://dbconvert.com/">dbconvert_studio</a></h2><p>同上 也是傻瓜式操作</p><h2 id="ssma"><a href="#ssma" class="headerlink" title="ssma"></a><a href="https://aka.ms/ssmaformysql">ssma</a></h2><p>这是个官方的</p><p>只支持 <code>mysql</code></p><p>需要安装 <code>vc 2019+</code> <a href="https://dev.mysql.com/downloads/connector/odbc/"><code>odbc_mysql</code></a></p><p>需要开启 <code>sqlserveragent</code> 服务</p><p><img src="/posts/11c11b49/mssql/sqlserveragent.png"></p><p>先在源表那转换表结构 再去目标表同步数据即可</p><h2 id="mysql-workbench"><a href="#mysql-workbench" class="headerlink" title="mysql workbench"></a><a href="https://dev.mysql.com/downloads/workbench/">mysql workbench</a></h2><p>没研究出来怎么用</p><h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><p>想了想 还是用程序从 <code>mysql</code> 中读出来 再更新到 <code>mssql</code> 中吧</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$mssql_db</span> = DB::<span class="title function_ invoke__">connection</span>(<span class="string">&#x27;mssql&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$local_database</span> = <span class="title function_ invoke__">config</span>(<span class="string">&#x27;database.connections.mariadb.database&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$local_tables</span> = DB::<span class="title function_ invoke__">connection</span>(<span class="string">&#x27;mariadb&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;information_schema.TABLES&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;TABLE_SCHEMA&#x27;</span>, <span class="variable">$local_database</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">pluck</span>(<span class="string">&#x27;table_comment&#x27;</span>, <span class="string">&#x27;table_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$local_columns</span> = DB::<span class="title function_ invoke__">connection</span>(<span class="string">&#x27;mariadb&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">table</span>(<span class="string">&#x27;information_schema.COLUMNS&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">select</span>(<span class="string">&#x27;table_name&#x27;</span>, <span class="string">&#x27;column_name&#x27;</span>, <span class="string">&#x27;column_comment&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;TABLE_SCHEMA&#x27;</span>, <span class="variable">$local_database</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">get</span>()</span><br><span class="line">    -&gt;<span class="title function_ invoke__">groupBy</span>(<span class="string">&#x27;table_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$local_columns</span> <span class="keyword">as</span> <span class="variable">$table_name</span> =&gt; <span class="variable">$table_columns</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$mssql_db</span>-&gt;<span class="title function_ invoke__">table</span>(<span class="variable">$table_name</span>)-&gt;<span class="title function_ invoke__">exists</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span>) &#123;</span><br><span class="line">        <span class="comment">// $this-&gt;error(&quot;&#123;$table_name&#125; no exists&quot;);</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$table_comment</span> = <span class="variable">$local_tables</span>[<span class="variable">$table_name</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$mssql_db</span>-&gt;<span class="title function_ invoke__">statement</span>(<span class="string">&quot;IF ((SELECT COUNT(*) FROM ::fn_listextendedproperty(&#x27;MS_Description&#x27;,</span></span><br><span class="line"><span class="string">&#x27;SCHEMA&#x27;, &#x27;dbo&#x27;,</span></span><br><span class="line"><span class="string">&#x27;TABLE&#x27;, ?, NULL, NULL)) &gt; 0)</span></span><br><span class="line"><span class="string">EXEC sp_updateextendedproperty</span></span><br><span class="line"><span class="string">&#x27;MS_Description&#x27;, ?,</span></span><br><span class="line"><span class="string">&#x27;SCHEMA&#x27;, &#x27;dbo&#x27;,</span></span><br><span class="line"><span class="string">&#x27;TABLE&#x27;, ?</span></span><br><span class="line"><span class="string">ELSE</span></span><br><span class="line"><span class="string">EXEC sp_addextendedproperty</span></span><br><span class="line"><span class="string">&#x27;MS_Description&#x27;, ?,</span></span><br><span class="line"><span class="string">&#x27;SCHEMA&#x27;, &#x27;dbo&#x27;,</span></span><br><span class="line"><span class="string">&#x27;TABLE&#x27;, ?&quot;</span>, [</span><br><span class="line">        <span class="variable">$table_name</span>,</span><br><span class="line">        <span class="variable">$table_comment</span>,</span><br><span class="line">        <span class="variable">$table_name</span>,</span><br><span class="line">        <span class="variable">$table_comment</span>,</span><br><span class="line">        <span class="variable">$table_name</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$table_columns</span> <span class="keyword">as</span> <span class="variable">$column</span>) &#123;</span><br><span class="line">        <span class="variable">$column_name</span> = <span class="variable">$column</span>-&gt;column_name;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$column_comment</span> = <span class="variable">$column</span>-&gt;column_comment;</span><br><span class="line">        <span class="variable">$mssql_db</span>-&gt;<span class="title function_ invoke__">statement</span>(<span class="string">&quot;IF ((SELECT COUNT(*) FROM ::fn_listextendedproperty(&#x27;MS_Description&#x27;,</span></span><br><span class="line"><span class="string">&#x27;SCHEMA&#x27;, &#x27;dbo&#x27;,</span></span><br><span class="line"><span class="string">&#x27;TABLE&#x27;, ?,</span></span><br><span class="line"><span class="string">&#x27;COLUMN&#x27;, ?)) &gt; 0)</span></span><br><span class="line"><span class="string">EXEC sp_updateextendedproperty</span></span><br><span class="line"><span class="string">&#x27;MS_Description&#x27;, ?,</span></span><br><span class="line"><span class="string">&#x27;SCHEMA&#x27;, &#x27;dbo&#x27;,</span></span><br><span class="line"><span class="string">&#x27;TABLE&#x27;, ?,</span></span><br><span class="line"><span class="string">&#x27;COLUMN&#x27;, ?</span></span><br><span class="line"><span class="string">ELSE</span></span><br><span class="line"><span class="string">EXEC sp_addextendedproperty</span></span><br><span class="line"><span class="string">&#x27;MS_Description&#x27;, ?,</span></span><br><span class="line"><span class="string">&#x27;SCHEMA&#x27;, &#x27;dbo&#x27;,</span></span><br><span class="line"><span class="string">&#x27;TABLE&#x27;, ?,</span></span><br><span class="line"><span class="string">&#x27;COLUMN&#x27;, ?&quot;</span>, [</span><br><span class="line">            <span class="variable">$table_name</span>,</span><br><span class="line">            <span class="variable">$column_name</span>,</span><br><span class="line">            <span class="variable">$column_comment</span>,</span><br><span class="line">            <span class="variable">$table_name</span>,</span><br><span class="line">            <span class="variable">$column_name</span>,</span><br><span class="line">            <span class="variable">$column_comment</span>,</span><br><span class="line">            <span class="variable">$table_name</span>,</span><br><span class="line">            <span class="variable">$column_name</span>,</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;所以 为什么会有这种需求&lt;/p&gt;
&lt;h1 id=&quot;迁移&quot;&gt;&lt;a href=&quot;#迁移&quot; class=&quot;headerlink&quot; title=&quot;迁移&quot;&gt;&lt;/a&gt;迁移&lt;/h1&gt;&lt;p&gt;有官方工具 也有第三方的&lt;/p&gt;
&lt;p&gt;但是 无一例外 都不支持迁移&lt;code&gt;表&lt;/code&gt;和&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>租房啊</title>
    <link href="https://puzzle9.github.io/posts/abbe4be6/"/>
    <id>https://puzzle9.github.io/posts/abbe4be6/</id>
    <published>2025-06-25T08:16:52.000Z</published>
    <updated>2025-06-25T08:29:38.771Z</updated>
    
    <content type="html"><![CDATA[<p>啊 租房</p><p>有了房子</p><p>那不得点满技能树</p><h1 id="住处"><a href="#住处" class="headerlink" title="住处"></a>住处</h1><p>有了 床架<br>那就得有 床垫<br>那就得有 床单<br>那就得有 被罩<br>那就得有 被褥<br>那就得有 枕套<br>那就得有 …</p><h1 id="厨房"><a href="#厨房" class="headerlink" title="厨房"></a>厨房</h1><p>有了 食物<br>那就得有 煤气灶&#x2F;电磁炉<br>那就得有 案板<br>那就得有 厨刀&#x2F;刮菜&#x2F;<br>那就得有 炒菜锅&#x2F;汤锅<br>那就得有 铲子&#x2F;漏勺&#x2F;汤勺&#x2F;饭勺<br>那就得有 油&#x2F;盐&#x2F;酱&#x2F;醋&#x2F;辣<br>那就得有 抹布&#x2F;钢丝球&#x2F;垃圾袋<br>那就得有 …</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;啊 租房&lt;/p&gt;
&lt;p&gt;有了房子&lt;/p&gt;
&lt;p&gt;那不得点满技能树&lt;/p&gt;
&lt;h1 id=&quot;住处&quot;&gt;&lt;a href=&quot;#住处&quot; class=&quot;headerlink&quot; title=&quot;住处&quot;&gt;&lt;/a&gt;住处&lt;/h1&gt;&lt;p&gt;有了 床架&lt;br&gt;那就得有 床垫&lt;br&gt;那就得有 床单&lt;br</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>cr660x 路由器研究</title>
    <link href="https://puzzle9.github.io/posts/2d3b406e/"/>
    <id>https://puzzle9.github.io/posts/2d3b406e/</id>
    <published>2025-06-24T08:51:04.000Z</published>
    <updated>2025-06-24T14:06:55.588Z</updated>
    
    <content type="html"><![CDATA[<p>嗯 ta的价格还是<code>50</code>没有变!!!</p><h1 id="解锁"><a href="#解锁" class="headerlink" title="解锁"></a>解锁</h1><p>按照解释说 如果获取不到ip时 会把自己ip设为 <code>169.254.31.2</code> 并且去 <code>169.254.31.1</code> 拉去参数并执行</p><p>那么 在 <code>archlinux</code> 中可以用 <a href="https://aur.archlinux.org/packages/linux-wifi-hotspot"><code>linux-wifi-hotspot</code></a> 提供的 <code>create_ap</code> 快捷创建热点</p><p>当然 要<a href="https://github.com/lakinduakash/linux-wifi-hotspot/issues/435">先停止</a> <code>NetworkManager</code> 服务</p><p>首先 开热点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_ap wlan0 lo ap 12345678 -g 169.254.31.1 --no-dnsmasq -<span class="built_in">dd</span></span><br></pre></td></tr></table></figure><p>再启动一个拉参数的服务</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> BaseHTTPRequestHandler, HTTPServer</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleServer</span>(<span class="title class_ inherited__">BaseHTTPRequestHandler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_POST</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;It comes!&quot;</span>)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;token&quot;</span>: <span class="string">&quot;; nvram set ssh_en=1; nvram commit; sed -i &#x27;s/channel=.*/channel=\&quot;debug\&quot;/g&#x27; /etc/init.d/dropbear; /etc/init.d/dropbear start;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.send_response(<span class="number">200</span>)</span><br><span class="line">        <span class="variable language_">self</span>.end_headers()</span><br><span class="line">        <span class="variable language_">self</span>.wfile.write(json.dumps(data).encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server_address = (<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">80</span>)</span><br><span class="line">httpd = HTTPServer(server_address, SimpleServer)</span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure><p>运行 <code>python server.py</code> 启动服务</p><p>再去访问</p><ul><li><code>http://&lt;CR660X设备IP&gt;/cgi-bin/luci/;stok=&lt;获取到的stok&gt;/api/misystem/extendwifi_connect?ssid=ap&amp;password=12345678</code></li></ul><p>可以看到日志有</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wlan0: STA aa:bb:cc:b2:b2:cc IEEE 802.11: authenticated</span><br><span class="line">wlan0: STA aa:bb:cc:b2:b2:cc IEEE 802.11: associated (aid 1)</span><br><span class="line">wlan0: AP-STA-CONNECTED aa:bb:cc:b2:b2:cc</span><br><span class="line">wlan0: STA aa:bb:cc:b2:b2:cc RADIUS: starting accounting session F94929848293082E</span><br><span class="line">wlan0: STA aa:bb:cc:b2:b2:cc WPA: pairwise key handshake completed (RSN)</span><br><span class="line">wlan0: EAPOL-4WAY-HS-COMPLETED aa:bb:cc:b2:b2:cc</span><br></pre></td></tr></table></figure><ul><li><code>http://&lt;CR660X设备IP&gt;/cgi-bin/luci/;stok=&lt;获取到的stok&gt;/api/xqsystem/oneclick_get_remote_token?username=xxx&amp;password=xxx&amp;nonce=xxx</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">It comes!</span><br><span class="line">169.254.31.2 - - [24/Jun/2025 20:34:47] &quot;POST /cgi-bin/luci/api/xqsystem/token HTTP/1.1&quot; 200 -</span><br></pre></td></tr></table></figure><p>至此 <code>ssh</code> 已经解锁</p><h1 id="刷入-breed-或-bpboot"><a href="#刷入-breed-或-bpboot" class="headerlink" title="刷入 breed 或 bpboot"></a>刷入 <a href="https://breed.hackpascal.net/r1338%20%5b2021-12-16%5d/breed-mt7621-xiaomi-r3g.bin">breed</a> 或 <a href="https://downloads.pangubox.com:63443/lintel/CR660X/pb-boot/pb-boot.img">bpboot</a></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/</span><br><span class="line">wget http://169.254.31.1:3000/pb-boot.img</span><br><span class="line">mtd write pb-boot.img Bootloader</span><br></pre></td></tr></table></figure><p>以网线模式插入 <code>lan</code> 口 进入页面</p><h1 id="刷-wrt-并优化"><a href="#刷-wrt-并优化" class="headerlink" title="刷 wrt 并优化"></a>刷 wrt 并优化</h1><h2 id="刷"><a href="#刷" class="headerlink" title="刷"></a>刷</h2><p>先在 <code>pb-boot</code> 刷入 <a href="https://downloads.openwrt.org/releases/24.10.1/targets/ramips/mt7621/openwrt-24.10.1-ramips-mt7621-xiaomi_mi-router-cr6608-initramfs-kernel.bin%60"><code>openwrt-24.10.1-ramips-mt7621-xiaomi_mi-router-cr6608-initramfs-kernel.bin</code></a></p><p>以空密码登录后 再刷入 <a href="https://downloads.openwrt.org/releases/24.10.1/targets/ramips/mt7621/openwrt-24.10.1-ramips-mt7621-xiaomi_mi-router-cr6608-squashfs-sysupgrade.bin"><code>openwrt-24.10.1-ramips-mt7621-xiaomi_mi-router-cr6608-squashfs-sysupgrade.bin</code></a></p><h2 id="国内源"><a href="#国内源" class="headerlink" title="国内源"></a>国内源</h2><ul><li><a href="https://help.mirrors.cernet.edu.cn/openwrt/">https://help.mirrors.cernet.edu.cn/openwrt/</a></li></ul><h2 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h2><ul><li><a href="https://github.com/jerrykuku/luci-theme-argon/releases/download/v2.3.2/luci-theme-argon_2.3.2-r20250207_all.ipk">luci-theme-argon-2.3.2-r20250207_all.apk</a></li></ul><h1 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h1><ul><li><a href="http://cnblogs.com/milton/p/18694477">http://cnblogs.com/milton/p/18694477</a></li><li><a href="https://haoyu.love/blog1389.html">https://haoyu.love/blog1389.html</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;嗯 ta的价格还是&lt;code&gt;50&lt;/code&gt;没有变!!!&lt;/p&gt;
&lt;h1 id=&quot;解锁&quot;&gt;&lt;a href=&quot;#解锁&quot; class=&quot;headerlink&quot; title=&quot;解锁&quot;&gt;&lt;/a&gt;解锁&lt;/h1&gt;&lt;p&gt;按照解释说 如果获取不到ip时 会把自己ip设为 &lt;code&gt;1</summary>
      
    
    
    
    <category term="路由器" scheme="https://puzzle9.github.io/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
    
  </entry>
  
  <entry>
    <title>hs8145v 光猫研究</title>
    <link href="https://puzzle9.github.io/posts/ac7934cb/"/>
    <id>https://puzzle9.github.io/posts/ac7934cb/</id>
    <published>2025-06-11T15:59:55.000Z</published>
    <updated>2025-06-12T06:30:03.956Z</updated>
    
    <content type="html"><![CDATA[<p>翻出来了来 &#96;&#96; 的光猫</p><p>好在是 默认 用户名 <code>telecomadmin</code> 密码 <code>nE7jA%5m</code></p><p><img src="/posts/11c11b49/145v/login.png"></p><p>这不 很顺畅的登录进去了</p><p>不得不说 这个界面后面的动态效果真不错 这可是好几年前的啊</p><p>又发现版本是 <code>B79.A</code> <code>V3.17.C10S115</code></p><p><img src="/posts/11c11b49/145v/manage_index.png"></p><p>嗯 逛了下论坛</p><p>发下 还有升级包 虽然此刻并不知道最后都因为<a href="https://www.chinadsl.net/forum.php?mod=viewthread&tid=171477">型号不匹配</a>而失败了</p><p>嗯 很顺畅</p><p>开启 <code>telnet</code></p><p><img src="/posts/11c11b49/145v/telnet.png"></p><p>连接</p><p>用户名 <code>root</code> 密码 <code>adminHW</code></p><p>嗯 很顺畅</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ telnet 192.168.2.11</span><br><span class="line">Trying 192.168.2.11...</span><br><span class="line">Connected to 192.168.2.11.</span><br><span class="line">Escape character is <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line"></span><br><span class="line">Welcome Visiting Huawei Home Gateway</span><br><span class="line">Copyright by Huawei Technologies Co., Ltd.</span><br><span class="line"></span><br><span class="line">Login:root</span><br><span class="line">Password:</span><br><span class="line">WAP&gt;su</span><br><span class="line">success!</span><br><span class="line">SU_WAP&gt;</span><br></pre></td></tr></table></figure><p>看了眼下下的刷机包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── HS8145V5_V500R019C20SPC115_China_All.bin</span><br><span class="line">├── HS8546V5_V500R019C00SPC110_china_all.bin</span><br><span class="line">├── HS8546V5_V500R019C20SPC050_china_all.bin</span><br><span class="line">└── HS8546V5_V500R019C20SPC105_china_all.bin</span><br></pre></td></tr></table></figure><p>开启 <a href="https://wiki.archlinux.org/title/TFTP"><code>tftp</code></a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S tftp-hpa</span><br><span class="line">systemctl start tftpd</span><br></pre></td></tr></table></figure><p>开刷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SU_WAP&gt;load pack by tftp svrip 192.168.1.21 remotefile HS8145V5_V500R019C20SPC115_China_All.bin</span><br><span class="line">success!</span><br><span class="line">SU_WAP&gt;Software Operation Faild!RetCode=0xf7204045!</span><br></pre></td></tr></table></figure><p>好了 <a href="https://www.right.com.cn/forum/thread-8370161-1-1.html">失败告终</a></p><p>但 不影响他作为一个<code>ap</code>呀</p><p>先将其余的网络都删除 新建一个</p><p><img src="/posts/11c11b49/145v/network_create.png"></p><p>虽然我没看明白为什么要再绑定个 <a href="https://www.right.com.cn/forum/thread-5768047-1-1.html"><code>vlan</code></a></p><p><img src="/posts/11c11b49/145v/vlan_setting.png"></p><p>再关闭 <code>dhcp</code> 的 <code>v4</code> 和 <code>v6</code> 并修改 <code>v4</code> 的 <code>ip地址</code></p><p><img src="/posts/11c11b49/145v/dhcp_ipv4.png"><br><img src="/posts/11c11b49/145v/dhcp_ipv6.png"></p><p>再修改下 <code>wifi</code> 的配置</p><p>再关闭 <code>上报</code> <code>日志</code> <code>ntp</code> 等<code>有的没的</code>的东西</p><p>好了 一个 <code>ap</code> 设置完成</p><p>至于 <code>补全shell</code> 等用 <code>win</code> 了后再研究</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;翻出来了来 &amp;#96;&amp;#96; 的光猫&lt;/p&gt;
&lt;p&gt;好在是 默认 用户名 &lt;code&gt;telecomadmin&lt;/code&gt; 密码 &lt;code&gt;nE7jA%5m&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/posts/11c11b49/145v/login.png</summary>
      
    
    
    
    <category term="路由器" scheme="https://puzzle9.github.io/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
    
  </entry>
  
  <entry>
    <title>dae 跨墙</title>
    <link href="https://puzzle9.github.io/posts/f1a175df/"/>
    <id>https://puzzle9.github.io/posts/f1a175df/</id>
    <published>2025-06-10T13:27:33.000Z</published>
    <updated>2025-06-10T13:47:18.230Z</updated>
    
    <content type="html"><![CDATA[<p>要说 什么简单 危险</p><p>唯有 <a href="https://github.com/wireguard"><code>跨墙</code></a></p><p>就是有点费 <code>身体</code> 与 <strong>红尘</strong></p><h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><blockquote><p>这是个跨过限制大门的工具</p></blockquote><h1 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h1><p>很佩服设计这个方案的大神们</p><p>要访问域名 就牵扯到了 <code>dns</code></p><p>要应对解析 就牵扯到了 <code>路由</code></p><p>要应对分流 就牵扯到了 <code>节点</code></p><p>要应对速度 就牵扯到了 <code>群组</code></p><p>要应对更新 就牵扯到了 <code>订阅</code></p><p>…</p><p>一个工具只做一件事</p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>直接安装 <a href="https://github.com/daeuniverse/daed"><code>daed</code></a> 使用 <code>网页</code> 版本配置吧</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;要说 什么简单 危险&lt;/p&gt;
&lt;p&gt;唯有 &lt;a href=&quot;https://github.com/wireguard&quot;&gt;&lt;code&gt;跨墙&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;就是有点费 &lt;code&gt;身体&lt;/code&gt; 与 &lt;strong&gt;红尘&lt;/strong&gt;&lt;/p&gt;
&lt;h</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ZeroTier 打洞 🕊</title>
    <link href="https://puzzle9.github.io/posts/b54f4888/"/>
    <id>https://puzzle9.github.io/posts/b54f4888/</id>
    <published>2025-06-10T13:15:58.000Z</published>
    <updated>2025-06-10T13:20:01.985Z</updated>
    
    <content type="html"><![CDATA[<p>要说 什么简单 刺激</p><p>唯有 <a href="https://github.com/zerotier/ZeroTierOne"><code>打洞</code></a></p><p>就是有点看 <code>运气</code> 与 <strong>红尘</strong></p><h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><blockquote><p>我也不知道这是个基于什么的 <code>ipv4</code> 的 <code>nat</code>打洞工具</p></blockquote><h1 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h1><p>我还在积攒运气中</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;要说 什么简单 刺激&lt;/p&gt;
&lt;p&gt;唯有 &lt;a href=&quot;https://github.com/zerotier/ZeroTierOne&quot;&gt;&lt;code&gt;打洞&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;就是有点看 &lt;code&gt;运气&lt;/code&gt; 与 &lt;strong&gt;红尘&lt;/str</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>rathole 穿透</title>
    <link href="https://puzzle9.github.io/posts/60e86601/"/>
    <id>https://puzzle9.github.io/posts/60e86601/</id>
    <published>2025-06-10T13:02:46.000Z</published>
    <updated>2025-06-13T08:14:55.737Z</updated>
    
    <content type="html"><![CDATA[<p>要说 什么简单 省心</p><p>唯有 <a href="https://github.com/yujqiao/rathole"><code>穿透</code></a></p><p>就是有点耗 <code>流量</code> 与 <strong>红尘</strong></p><h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><blockquote><p>这是个内网穿透工具 类似于 <a href="https://github.com/fatedier/frp"><code>frp</code></a> <a href="https://github.com/ehang-io/nps"><code>nps</code></a> 等</p></blockquote><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="alpine"><a href="#alpine" class="headerlink" title="alpine"></a>alpine</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirror.nju.edu.cn/alpine/edge/testing/x86_64/rathole-0.5.0-r0.apk</span><br><span class="line">apk add ./rathole-0.5.0-r0.apk</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /etc/rathole</span><br></pre></td></tr></table></figure><p><code>/etc/init.d/ratholec</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/sbin/openrc-run</span></span><br><span class="line"></span><br><span class="line">name=<span class="string">&quot;Rathole Client Service&quot;</span></span><br><span class="line">description=<span class="string">&quot;Rathole Client Service&quot;</span></span><br><span class="line"><span class="built_in">command</span>=<span class="string">&quot;/usr/bin/rathole&quot;</span></span><br><span class="line">command_args=<span class="string">&quot;-c /etc/rathole/rathole.toml&quot;</span></span><br><span class="line">pidfile=<span class="string">&quot;/run/<span class="variable">$SVCNAME</span>.pid&quot;</span></span><br><span class="line">command_background=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">depend</span></span>() &#123;</span><br><span class="line">    need net</span><br><span class="line">    after firewall</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /etc/init.d/ratholec</span><br><span class="line">rc-service ratholec start</span><br><span class="line">rc-update add ratholec</span><br></pre></td></tr></table></figure><h2 id="debian"><a href="#debian" class="headerlink" title="debian"></a>debian</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt install unzip</span><br><span class="line">wget https://github.com/yujqiao/rathole/releases/download/v0.5.0/rathole-x86_64-unknown-linux-gnu.zip</span><br><span class="line">unzip -d /usr/bin/ rathole-x86_64-unknown-linux-gnu.zip</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/bin/rathole</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /etc/rathole</span><br></pre></td></tr></table></figure><p><code>/etc/systemd/system/ratholes.service</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Rathole Server Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5s</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line">User=root</span><br><span class="line"></span><br><span class="line">WorkingDirectory=/etc/rathole</span><br><span class="line">ExecStart=/usr/bin/rathole -s /etc/rathole/rathole.toml</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> ratholes.service --now</span><br></pre></td></tr></table></figure><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[server]</span></span><br><span class="line"><span class="comment"># 服务器监听了这个端口</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="string">&quot;0.0.0.0:2333&quot;</span></span><br><span class="line"><span class="attr">default_token</span> = <span class="string">&quot;rathole&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="comment"># 客户端通过ip与端口进行连接</span></span><br><span class="line"><span class="attr">remote_addr</span> = <span class="string">&quot;&#123;ip&#125;:2333&quot;</span></span><br><span class="line"><span class="attr">default_token</span> = <span class="string">&quot;rathole&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密方式如下</span></span><br><span class="line"><span class="section">[server.transport]</span></span><br><span class="line"><span class="attr">type</span> = <span class="string">&quot;noise&quot;</span></span><br><span class="line"><span class="section">[server.transport.noise]</span></span><br><span class="line"><span class="attr">local_private_key</span> = <span class="string">&quot;nKdq0NUp3pcnRzfQEtFI/Qe/GdO6zYh1G56etEZgeIo=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[client.transport]</span></span><br><span class="line"><span class="attr">type</span> = <span class="string">&quot;noise&quot;</span></span><br><span class="line"><span class="section">[client.transport.noise]</span></span><br><span class="line"><span class="attr">remote_public_key</span> = <span class="string">&quot;OZgtXqojrnphLrNL/o8tFYxkRDCPNaoRfRxbuMOgqHg=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端起了一个叫 go 的服务 对外端口为 16070</span></span><br><span class="line"><span class="section">[server.services.go]</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="string">&quot;0.0.0.0:16070&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端将本机的 6070 端口 转发给服务端的 go 服务</span></span><br><span class="line"><span class="section">[client.services.go]</span></span><br><span class="line"><span class="attr">local_addr</span> = <span class="string">&quot;127.0.0.1:6070&quot;</span></span><br></pre></td></tr></table></figure><p>这个配置文件可以写到一起 他是用 <code>命令</code> 去区分 当前是运行的 <code>服务端 --server</code> 还是 <code>客户端 --client</code> 的<br>置于区分是不是同一个服务 用的是 <code>services.&#123;name&#125;</code> 进行区分的<br>这个<code>key</code>用 <code>rathole --genkey</code> 生成</p><h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><h2 id="supervisor"><a href="#supervisor" class="headerlink" title="supervisor"></a>supervisor</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[program:rathole]</span><br><span class="line">command=rathole --client /data/rathole/config.toml</span><br><span class="line">directory=/data/rathole</span><br><span class="line">user=root</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;要说 什么简单 省心&lt;/p&gt;
&lt;p&gt;唯有 &lt;a href=&quot;https://github.com/yujqiao/rathole&quot;&gt;&lt;code&gt;穿透&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;就是有点耗 &lt;code&gt;流量&lt;/code&gt; 与 &lt;strong&gt;红尘&lt;/strong&gt;&lt;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>WireGuard 组网</title>
    <link href="https://puzzle9.github.io/posts/3ec5a2b7/"/>
    <id>https://puzzle9.github.io/posts/3ec5a2b7/</id>
    <published>2025-06-10T11:44:02.000Z</published>
    <updated>2025-06-10T13:38:56.602Z</updated>
    
    <content type="html"><![CDATA[<p>要说 什么简单 省事</p><p>唯有 <a href="https://github.com/wireguard"><code>组网</code></a></p><p>就是有点爽 <code>爱好</code> 与 <strong>红尘</strong></p><h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><blockquote><p>这是个基于 <code>UDP</code> 的异地组网工具</p></blockquote><p>先放下官方的定义 <code>对等体/节点/设备</code> <code>Peer/Node/Device</code></p><p>诺 如下</p><table><thead><tr><th align="center">名称</th><th align="center">虚拟ip</th><th align="center">自带网段</th></tr></thead><tbody><tr><td align="center">Isaac</td><td align="center">192.168.99.1&#x2F;32</td><td align="center"></td></tr><tr><td align="center">Alice</td><td align="center">192.168.99.2&#x2F;32</td><td align="center">192.168.2.0&#x2F;24</td></tr><tr><td align="center">Bob</td><td align="center">192.168.99.3&#x2F;32</td><td align="center">192.168.3.0&#x2F;24</td></tr><tr><td align="center">Carol</td><td align="center">192.168.99.4&#x2F;32</td><td align="center">192.168.4.0&#x2F;24</td></tr><tr><td align="center">Dave</td><td align="center">192.168.99.5&#x2F;32</td><td align="center">192.168.5.0&#x2F;24</td></tr></tbody></table><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ul><li>将 <code>net.ipv4.ip_forward = 1</code> 添加到 <code>/etc/sysctl.conf</code></li></ul><h2 id="debian"><a href="#debian" class="headerlink" title="debian"></a>debian</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install wireguard-tools iptables</span><br></pre></td></tr></table></figure><h2 id="alpine"><a href="#alpine" class="headerlink" title="alpine"></a>alpine</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apk add wireguard-tools-wg-quick iptables wireguard-tools-openrc</span><br><span class="line">rc-update add sysctl</span><br></pre></td></tr></table></figure><p>修改 <code>/etc/conf.d/iptables</code> 中 <code>IPFORWARD</code> 为 <code>yes</code></p><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><ul><li>公钥私钥采用 <code>wg genkey | tee key.privatekey | wg pubkey &gt; key.publickey</code> 生成 每个人都是独立的</li><li>配置文件在 <code>/etc/wireguard</code> 文件名就是网卡名 规则为 <code>^[a-zA-Z0-9_=+.-]&#123;1,15&#125;$</code></li><li>以下配置文件有精简</li></ul><h2 id="Alice-和-Bob-一起玩-Alice-有公网"><a href="#Alice-和-Bob-一起玩-Alice-有公网" class="headerlink" title="Alice 和 Bob 一起玩 Alice 有公网"></a><code>Alice</code> 和 <code>Bob</code> 一起玩 <code>Alice</code> 有公网</h2><ul><li><code>wg-quick up wg_ab_a</code></li></ul><p><code>Alice</code> <code>/etc/wireguard/wg_ab_a.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">Address = 192.168.99.2/24</span><br><span class="line">ListenPort = 51820</span><br><span class="line">PrivateKey = &#123;Alice_PrivateKey&#125;</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Bob</span><br><span class="line">PublicKey = &#123;Bob_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.3/32, 192.168.3.0/24</span><br></pre></td></tr></table></figure><p><code>Bob</code> <code>/etc/wireguard/wg_ab_a.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">Address = 192.168.99.3/24</span><br><span class="line">PrivateKey = &#123;Bob_PrivateKey&#125;</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Alice</span><br><span class="line">Endpoint = &#123;Alice_ip&#125;:51820</span><br><span class="line">PublicKey = &#123;Alice_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.2/32, 192.168.2.0/24</span><br></pre></td></tr></table></figure><h2 id="Alice-Bob-Carol-一起玩-Alice-有公网"><a href="#Alice-Bob-Carol-一起玩-Alice-有公网" class="headerlink" title="Alice Bob Carol 一起玩 Alice 有公网"></a><code>Alice</code> <code>Bob</code> <code>Carol</code> 一起玩 <code>Alice</code> 有公网</h2><ul><li><code>wg-quick up wg_abc_a</code></li><li><code>Bob</code> <code>Carol</code> 玩耍时通过 <code>Alice</code> 中转</li></ul><p><code>Alice</code> <code>/etc/wireguard/wg_abc_a.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">Address = 192.168.99.2/24</span><br><span class="line">ListenPort = 51820</span><br><span class="line">PrivateKey = &#123;Alice_PrivateKey&#125;</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Bob</span><br><span class="line">PublicKey = &#123;Bob_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.3/32, 192.168.3.0/24</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Carol</span><br><span class="line">PublicKey = &#123;Carol_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.4/32, 192.168.4.0/24</span><br></pre></td></tr></table></figure><p><code>Bob</code> <code>/etc/wireguard/wg_abc_a.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">Address = 192.168.99.3/24</span><br><span class="line">PrivateKey = &#123;Bob_PrivateKey&#125;</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Alice</span><br><span class="line">Endpoint = &#123;Alice_ip&#125;:51820</span><br><span class="line">PublicKey = &#123;Alice_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.2/32, 192.168.3.0/24, 192.168.4.0/24</span><br></pre></td></tr></table></figure><p><code>Carol</code> <code>/etc/wireguard/wg_abc_a.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">Address = 192.168.99.4/24</span><br><span class="line">PrivateKey = &#123;Carol_PrivateKey&#125;</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Alice</span><br><span class="line">Endpoint = &#123;Alice_ip&#125;:51820</span><br><span class="line">PublicKey = &#123;Alice_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.2/32, 192.168.2.0/24, 192.168.4.0/24</span><br></pre></td></tr></table></figure><h2 id="Alice-Bob-Carol-一起玩-都有公网"><a href="#Alice-Bob-Carol-一起玩-都有公网" class="headerlink" title="Alice Bob Carol 一起玩 都有公网"></a><code>Alice</code> <code>Bob</code> <code>Carol</code> 一起玩 都有公网</h2><h1 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><h2 id="Address-和-AllowedIPs-什么"><a href="#Address-和-AllowedIPs-什么" class="headerlink" title="Address 和 AllowedIPs 什么"></a><code>Address</code> 和 <code>AllowedIPs</code> 什么</h2><p>站在 <code>Alice</code> 的角度</p><ul><li><code>Address</code> 是组网的ip地址 只有同个局域网才能一起玩</li><li><code>[Peer]</code> 可以找谁一起玩</li><li><code>AllowedIPs</code> 是路由 找他可以通过那个路出去</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line"># 我组了一个局域网</span><br><span class="line">Address = 192.168.99.2/24</span><br><span class="line"># 监听地址是这个</span><br><span class="line">ListenPort = 51820</span><br><span class="line"># 我的私钥</span><br><span class="line">PrivateKey = &#123;Alice_PrivateKey&#125;</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Bob</span><br><span class="line"># 访问 192.168.3.0/24 网段时 去找 Bob</span><br><span class="line">PublicKey = &#123;Bob_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.3/32, 192.168.3.0/24</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Carol</span><br><span class="line"># 访问 192.168.4.0/24 网段时 去找 Carol</span><br><span class="line">PublicKey = &#123;Carol_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.4/32, 192.168.4.0/24</span><br></pre></td></tr></table></figure><p>至于 <code>WireGuard</code> 怎么知道是 <code>Bob</code> 还是 <code>Carol</code> 来找自己了<br>那不是有 <code>PublicKey</code> 字段嘛 我推测是用它判断的</p><p>站在 <code>Bob</code> 的角度</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line"># 我组了或者加入了一个局域网</span><br><span class="line">Address = 192.168.99.3/24</span><br><span class="line"># 我的私钥</span><br><span class="line">PrivateKey = &#123;Bob_PrivateKey&#125;</span><br><span class="line">[Peer]</span><br><span class="line"># Name = Alice</span><br><span class="line">Endpoint = &#123;Alice_ip&#125;:51820</span><br><span class="line">PublicKey = &#123;Alice_PublicKey&#125;</span><br><span class="line">AllowedIPs = 192.168.99.2/32, 192.168.3.0/24, 192.168.4.0/24</span><br><span class="line"># 每25秒去敲下 Alice 的门 防止他忘记我</span><br><span class="line">PersistentKeepalive = 25</span><br></pre></td></tr></table></figure><p>可以通过 <code>Endpoint</code> 这个去找 <code>Alice</code> 玩<br>我也想去找 <code>Carol</code> 玩 但是他和我都没得 <code>公网</code><br>那我只能把相关的网段都给 <code>Alice</code> 让他去中转</p><h1 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h1><ul><li><a href="https://wiki.alpinelinux.org/wiki/Configure_a_Wireguard_interface_(wg)">https://wiki.alpinelinux.org/wiki/Configure_a_Wireguard_interface_(wg)</a></li><li><a href="https://github.com/pirate/wireguard-docs">https://github.com/pirate/wireguard-docs</a></li><li><a href="https://wiki.archlinux.org/title/WireGuard">https://wiki.archlinux.org/title/WireGuard</a></li><li><a href="https://www.skyone.host/2024/wireguard-configure">https://www.skyone.host/2024/wireguard-configure</a></li><li><a href="https://v2ex.com/t/934101">https://v2ex.com/t/934101</a></li><li><a href="https://www.reddit.com/r/homelab/comments/gw22bv/wireguard_confusion_on_allowedips_and_addresses">https://www.reddit.com/r/homelab/comments/gw22bv/wireguard_confusion_on_allowedips_and_addresses</a></li><li><a href="https://www.cnblogs.com/milton/p/14178344.html">https://www.cnblogs.com/milton/p/14178344.html</a></li><li><a href="https://www.cyberciti.biz/faq/how-to-set-up-wireguard-vpn-server-on-alpine-linux/">https://www.cyberciti.biz/faq/how-to-set-up-wireguard-vpn-server-on-alpine-linux/</a></li><li><a href="https://github.com/smile365/blog/blob/master/wireguard.md">https://github.com/smile365/blog/blob/master/wireguard.md</a></li><li><a href="https://forum.proxmox.com/threads/proxmox-lxc-container-alpine-linux-set-up-wireguard-vpn-server-howto-05-2022-rev1.110778/">https://forum.proxmox.com/threads/proxmox-lxc-container-alpine-linux-set-up-wireguard-vpn-server-howto-05-2022-rev1.110778/</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;要说 什么简单 省事&lt;/p&gt;
&lt;p&gt;唯有 &lt;a href=&quot;https://github.com/wireguard&quot;&gt;&lt;code&gt;组网&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;就是有点爽 &lt;code&gt;爱好&lt;/code&gt; 与 &lt;strong&gt;红尘&lt;/strong&gt;&lt;/p&gt;
&lt;h</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>pve 的 OpenWrt</title>
    <link href="https://puzzle9.github.io/posts/73ac8ef6/"/>
    <id>https://puzzle9.github.io/posts/73ac8ef6/</id>
    <published>2025-06-07T04:27:01.000Z</published>
    <updated>2025-06-11T15:42:35.673Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前置工作"><a href="#前置工作" class="headerlink" title="前置工作"></a>前置工作</h1><p><code>x86</code> 架构中 先下载最新的 <a href="https://downloads.openwrt.org/releases/24.10.1/targets/x86/64/openwrt-24.10.1-x86-64-generic-ext4-combined-efi.img.gz"><code>generic-ext4-combined-efi.img.gz</code></a></p><p>上传到 <code>pve</code> 的 <code>tmp</code> 目录</p><p>解压</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/wrt</span><br><span class="line">gzip -d openwrt-24.10.1-x86-64-generic-ext4-combined-efi.img.gz</span><br></pre></td></tr></table></figure><h2 id="自定义镜像"><a href="#自定义镜像" class="headerlink" title="自定义镜像"></a>自定义镜像</h2><p>先创建一个空的 <code>raw</code> 镜像文件<br>再把现有的东西 在复制进去的同时去修改文件 达到自定义的目的</p><h3 id="创建空的镜像并分区挂载"><a href="#创建空的镜像并分区挂载" class="headerlink" title="创建空的镜像并分区挂载"></a>创建空的镜像并分区挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qemu-img create -f raw openwrt_new.raw 1G</span><br><span class="line">losetup /dev/loop2 openwrt_new.raw</span><br></pre></td></tr></table></figure><p>分区时候 一个 <code>efi</code> 一个 <code>data</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cfdisk /dev/loop2</span><br><span class="line">kpartx -a /dev/loop2</span><br></pre></td></tr></table></figure><p>格式化分区并挂载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkfs.fat -n EFI -F16 /dev/mapper/loop2p1</span><br><span class="line">mkfs.ext4 -L OpenWrt /dev/mapper/loop2p2</span><br><span class="line"></span><br><span class="line">mount --<span class="built_in">mkdir</span> /dev/mapper/loop2p1 /tmp/wrt/new/boot</span><br><span class="line">mount --<span class="built_in">mkdir</span> /dev/mapper/loop2p2 /tmp/wrt/new/data</span><br></pre></td></tr></table></figure><h3 id="挂载现有镜像"><a href="#挂载现有镜像" class="headerlink" title="挂载现有镜像"></a>挂载现有镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">losetup /dev/loop4 openwrt-24.10.1-x86-64-generic-ext4-combined-efi.img</span><br><span class="line">kpartx -a /dev/loop4</span><br><span class="line">mount --<span class="built_in">mkdir</span> /dev/mapper/loop4p1 /tmp/wrt/old/boot</span><br><span class="line">mount --<span class="built_in">mkdir</span> /dev/mapper/loop4p2 /tmp/wrt/old/data</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="复制旧的文件到新系统"><a href="#复制旧的文件到新系统" class="headerlink" title="复制旧的文件到新系统"></a>复制旧的文件到新系统</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rsync -qaHAXS /tmp/wrt/old/boot/ /tmp/wrt/new/boot/</span><br><span class="line">rsync -qaHAXS /tmp/wrt/old/data/ /tmp/wrt/new/data/</span><br></pre></td></tr></table></figure><h4 id="修复新系统引导"><a href="#修复新系统引导" class="headerlink" title="修复新系统引导"></a>修复新系统引导</h4><p>编辑 <code>/tmp/wrt/new/boot/boot/grub/grub.cfg</code> 如下</p><p>修改的有</p><ul><li><code>PARTUUID</code> <code>d9d3bec6-66ad-6945-acc6-cce5071fce8f</code> 用 <code>blkid</code> 获取到的 <code>/dev/mapper/loop2p2</code> 的值</li><li><code>timeout</code> 等待时间</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">serial --unit=0 --speed=115200 --word=8 --parity=no --stop=1 --rtscts=off</span><br><span class="line">terminal_input console serial; terminal_output console serial</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> default=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="built_in">set</span> <span class="built_in">timeout</span>=<span class="string">&quot;1&quot;</span></span><br><span class="line">search -l kernel -s root</span><br><span class="line"></span><br><span class="line">menuentry <span class="string">&quot;OpenWrt&quot;</span> &#123;</span><br><span class="line">        linux /boot/vmlinuz root=PARTUUID=d9d3bec6-66ad-6945-acc6-cce5071fce8f rootwait  console=tty1 console=ttyS0,115200n8 noinitrd</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="关闭wan防火墙"><a href="#关闭wan防火墙" class="headerlink" title="关闭wan防火墙"></a>关闭<code>wan</code>防火墙</h4><p>编辑 <code>/tmp/wrt/new/data/etc/config/firewall</code></p><p>将 里面的 <code>REJECT</code> 改为 <code>ACCEPT</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">config defaults</span><br><span class="line">        option input &#x27;ACCEPT&#x27;</span><br><span class="line">        option output &#x27;ACCEPT&#x27;</span><br><span class="line">        option forward &#x27;ACCEPT&#x27;</span><br><span class="line">        option synflood_protect &#x27;1&#x27;</span><br><span class="line"></span><br><span class="line">config zone</span><br><span class="line">        option name &#x27;lan&#x27;</span><br><span class="line">        list network &#x27;lan&#x27;</span><br><span class="line">        option input &#x27;ACCEPT&#x27;</span><br><span class="line">        option output &#x27;ACCEPT&#x27;</span><br><span class="line">        option forward &#x27;ACCEPT&#x27;</span><br><span class="line"></span><br><span class="line">config zone</span><br><span class="line">        option name &#x27;wan&#x27;</span><br><span class="line">        list network &#x27;wan&#x27;</span><br><span class="line">        list network &#x27;wan6&#x27;</span><br><span class="line">        option input &#x27;ACCEPT&#x27;</span><br><span class="line">        option output &#x27;ACCEPT&#x27;</span><br><span class="line">        option forward &#x27;ACCEPT&#x27;</span><br><span class="line">        option mtu_fix &#x27;1&#x27;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="修改网络配置"><a href="#修改网络配置" class="headerlink" title="修改网络配置"></a>修改网络配置</h4><p><code>/etc/config/network</code> 这玩意貌似启动成功后才有</p><p>等进入后用终端改吧</p><h3 id="取消挂载完成修改"><a href="#取消挂载完成修改" class="headerlink" title="取消挂载完成修改"></a>取消挂载完成修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">umount /tmp/wrt/new/boot/</span><br><span class="line">umount /tmp/wrt/new/data/</span><br><span class="line">kpartx -d /dev/loop2</span><br><span class="line">losetup -d /dev/loop2</span><br><span class="line"></span><br><span class="line">umount /tmp/wrt/old/boot/</span><br><span class="line">umount /tmp/wrt/old/data/</span><br><span class="line">kpartx -d /dev/loop4</span><br><span class="line">losetup -d /dev/loop4</span><br></pre></td></tr></table></figure><h1 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a>导入镜像</h1><p><code>pve</code> 将改为 <code>uefi</code> 启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qm disk import [openwrt vm <span class="built_in">id</span>] /tmp/wrt/openwrt_new.raw <span class="built_in">local</span></span><br></pre></td></tr></table></figure><h1 id="pve-ip-设置"><a href="#pve-ip-设置" class="headerlink" title="pve ip 设置"></a><code>pve</code> <code>ip</code> 设置</h1><p>🕊</p><h1 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><h2 id="主路由重启后ipv6未更新情况"><a href="#主路由重启后ipv6未更新情况" class="headerlink" title="主路由重启后ipv6未更新情况"></a>主路由重启后ipv6未更新情况</h2><p><code>ipv6</code> 有效期很长 然而主路由拨号获得了新的之后 老的不会自己失效</p><p>这就导致无网络连接了</p><p>临时先以计划任务的的模式去判断 再去重启网口</p><p><code>*/15 * * * * /data/scripts/check_wan6_count_auto_restart.sh</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">ipv6_count=$(ip -6 addr show dev eth3 | grep inet6 | grep -v fe80:: | <span class="built_in">wc</span> -l)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ipv6_count</span>&quot;</span> -ge 2 ]; <span class="keyword">then</span></span><br><span class="line">        logger -t custom_scripts_wan6 <span class="string">&quot;ipv6 count: <span class="variable">$ipv6_count</span> restart&quot;</span></span><br><span class="line">        ifup wan6</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>再准备研究监听逻辑</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://openwrt.org/docs/guide-user/installation/openwrt_x86">https://openwrt.org/docs/guide-user/installation/openwrt_x86</a></li><li><a href="https://xotechy.com/blog/mount-a-raw-qemu-image-file-to-your-linux-system/">https://xotechy.com/blog/mount-a-raw-qemu-image-file-to-your-linux-system/</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;前置工作&quot;&gt;&lt;a href=&quot;#前置工作&quot; class=&quot;headerlink&quot; title=&quot;前置工作&quot;&gt;&lt;/a&gt;前置工作&lt;/h1&gt;&lt;p&gt;&lt;code&gt;x86&lt;/code&gt; 架构中 先下载最新的 &lt;a href=&quot;https://downloads.openwrt</summary>
      
    
    
    
    
    <category term="pve" scheme="https://puzzle9.github.io/tags/pve/"/>
    
    <category term="OpenWrt" scheme="https://puzzle9.github.io/tags/OpenWrt/"/>
    
  </entry>
  
  <entry>
    <title>pve 自定义分区</title>
    <link href="https://puzzle9.github.io/posts/f3bcfc95/"/>
    <id>https://puzzle9.github.io/posts/f3bcfc95/</id>
    <published>2025-06-05T12:16:49.000Z</published>
    <updated>2025-06-05T13:02:01.223Z</updated>
    
    <content type="html"><![CDATA[<p>通常 <code>pve</code> 安装出来的是 <code>lvm</code> 作为兼容层 上面再是具体的文件系统</p><p>可是吧 单硬盘 我用不到</p><p>是的 我不喜欢这种分区方案</p><p>可是 这是 <code>linux</code> 啊 那不都是通用的</p><p>开搞</p><blockquote><p>备份 再恢复 就行</p></blockquote><p>先采用官方正常的安装流程 装完后进入 <code>livecd</code> 推荐 <a href="https://archlinux.org/download/"><code>archlinux</code></a> 的</p><h1 id="先挂载系统分区"><a href="#先挂载系统分区" class="headerlink" title="先挂载系统分区"></a>先挂载系统分区</h1><h2 id="是-lvm-格式的"><a href="#是-lvm-格式的" class="headerlink" title="是 lvm 格式的"></a>是 <a href="https://superuser.com/questions/116617/how-to-mount-an-lvm-volume"><code>lvm</code></a> 格式的</h2><p>先 使用 <code>lvscan</code> 罗列出来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@pve:/tmp# lvscan</span><br><span class="line">  ACTIVE            <span class="string">&#x27;/dev/pve-OLD-A39EDD75/root&#x27;</span> [446.00 GiB] inherit</span><br></pre></td></tr></table></figure><p>再直接挂载就行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/mapper/pve--OLD--A39EDD75-root olda/</span><br></pre></td></tr></table></figure><h2 id="是-btrfs-格式的"><a href="#是-btrfs-格式的" class="headerlink" title="是 btrfs 格式的"></a>是 <code>btrfs</code> 格式的</h2><p>直接挂载分区就行 默认安装的是不带子卷的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/nvme0n1p3 olda/</span><br></pre></td></tr></table></figure><h1 id="备份文件"><a href="#备份文件" class="headerlink" title="备份文件"></a>备份文件</h1><h2 id="使用-rsync"><a href="#使用-rsync" class="headerlink" title="使用 rsync"></a>使用 <a href="https://wiki.archlinux.org/title/Rsync#File_system_cloning"><code>rsync</code></a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -qaHAXS olda/ /tmp/bak/</span><br></pre></td></tr></table></figure><h1 id="重新分区"><a href="#重新分区" class="headerlink" title="重新分区"></a>重新分区</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfdisk /dev/nvme0n1</span><br></pre></td></tr></table></figure><p>分两个</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Device           Start       End   Sectors  Size Type</span><br><span class="line">/dev/nvme0n1p1    2048   2099199   2097152    1G EFI System</span><br><span class="line">/dev/nvme0n1p2 2099200 966789119 964689920  460G Linux filesystem</span><br></pre></td></tr></table></figure><p>再格式化下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkfs.fat -n EFI -F32 /dev/nvme0n1p1</span><br><span class="line">mkfs.btrfs -L PVE /dev/nvme0n1p2</span><br></pre></td></tr></table></figure><h2 id="创建子卷"><a href="#创建子卷" class="headerlink" title="创建子卷"></a>创建子卷</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/nvme0n1p2 /tmp/newbtrfs</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /tmp/newbtrfs</span><br><span class="line"><span class="comment"># 就这么创建下去</span></span><br><span class="line">btrfs subvolume create @</span><br></pre></td></tr></table></figure><p>大概有这些子卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@pve:/tmp/newbtrfs# tree -L 1</span><br><span class="line">.</span><br><span class="line">├── @</span><br><span class="line">├── @pvevz</span><br><span class="line">├── @root</span><br><span class="line">├── @var_cache</span><br><span class="line">├── @var_log</span><br><span class="line">└── @var_tmp</span><br></pre></td></tr></table></figure><h2 id="挂载新分区"><a href="#挂载新分区" class="headerlink" title="挂载新分区"></a>挂载新分区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t btrfs -o subvol=/@,compress=zstd /dev/nvme0n1p2 /tmp/newpve</span><br></pre></td></tr></table></figure><h1 id="恢复备份"><a href="#恢复备份" class="headerlink" title="恢复备份"></a>恢复备份</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -qaHAXS /tmp/bak/ /tmp/newpve/</span><br></pre></td></tr></table></figure><h1 id="修复引导"><a href="#修复引导" class="headerlink" title="修复引导"></a>修复引导</h1><p>默认用的 <code>grub2</code> 进行引导的</p><p>参考 <a href="https://pve.proxmox.com/wiki/Host_Bootloader"><code>proxmox-boot-tool</code></a> 这个</p><p>而我 用的 <code>systemd-boot</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch-chroot /tmp/newpve/</span><br></pre></td></tr></table></figure><p>修改 <code>/etc/kernel/cmdline</code> 加入子卷启动项 <code>rootflags=subvol=@</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root=UUID=eb239303-5067-4e32-add8-55fd643059ac rootflags=subvol=@ rw</span><br></pre></td></tr></table></figure><p>运行 <code>proxmox-boot-tool clean</code> 删除 <code>/etc/kernel/proxmox-boot-uuids</code> 中旧的 <code>esp</code> <code>uuid</code></p><p>运行 <code>proxmox-boot-tool init /dev/nvme0n1p1</code> 自动处理 <code>efi</code> 引导等</p><p>至此 <code>reboot</code> 后应该可以进入系统了</p><h1 id="关闭-grub-提示信息"><a href="#关闭-grub-提示信息" class="headerlink" title="关闭 grub 提示信息"></a>关闭 <code>grub</code> 提示信息</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Removable bootloader found at <span class="string">&#x27;/boot/efi/EFI/BOOT/BOOTX64.efi&#x27;</span>, but GRUB packages not <span class="built_in">set</span> up to update it!</span><br><span class="line">Run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;grub-efi-amd64 grub2/force_efi_extra_removable boolean true&#x27;</span> | debconf-set-selections -v -u</span><br><span class="line"></span><br><span class="line">Then reinstall GRUB with <span class="string">&#x27;apt install --reinstall grub-efi-amd64&#x27;</span></span><br></pre></td></tr></table></figure><p>进入系统后 执行 <code>echo &#39;grub-efi-amd64 grub2/force_efi_extra_removable boolean true&#39; | debconf-set-selections -v -u</code></p><p>置于能不能卸载 <code>grub</code> 这件事情呢 发现是不行的</p><p>但是可以卸载 <code>memtest86+</code></p><h1 id="卸载旧内核"><a href="#卸载旧内核" class="headerlink" title="卸载旧内核"></a>卸载旧内核</h1><p>他是 <code>proxmox-kernel-</code> 开头的包</p><p>直接 <code>apt purge proxmox-kernel-6.8.12-9-pve</code> 就行</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;通常 &lt;code&gt;pve&lt;/code&gt; 安装出来的是 &lt;code&gt;lvm&lt;/code&gt; 作为兼容层 上面再是具体的文件系统&lt;/p&gt;
&lt;p&gt;可是吧 单硬盘 我用不到&lt;/p&gt;
&lt;p&gt;是的 我不喜欢这种分区方案&lt;/p&gt;
&lt;p&gt;可是 这是 &lt;code&gt;linux&lt;/code&gt; 啊 </summary>
      
    
    
    
    
    <category term="pve" scheme="https://puzzle9.github.io/tags/pve/"/>
    
  </entry>
  
  <entry>
    <title>长大</title>
    <link href="https://puzzle9.github.io/posts/f18e40a8/"/>
    <id>https://puzzle9.github.io/posts/f18e40a8/</id>
    <published>2025-05-24T10:02:24.000Z</published>
    <updated>2025-05-24T10:07:17.731Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>都说 被保护的太好的人是无法成长的</p></blockquote><p>那 自己放弃成长呢</p><p>嗯 ? !!</p><p>转眼间 已经 <code>25岁4月</code> 啦</p><p>周围的人 结婚的结婚 恋爱的恋爱 结婚的结婚 生娃的生娃</p><p>意识到 自己是普通人 没有那逆天的系统后</p><p>再加上一丢丢债务</p><p>瞬间觉得 得长大了</p>]]></content>
    
    
    <summary type="html">碎碎念</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Android TV 优化</title>
    <link href="https://puzzle9.github.io/posts/71fefb90/"/>
    <id>https://puzzle9.github.io/posts/71fefb90/</id>
    <published>2025-05-20T05:35:10.000Z</published>
    <updated>2025-05-20T06:16:17.445Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>这是一个 已经 有 好多年 历史的 <code>55</code>寸 的 大电视</p></blockquote><p>那时候的热播剧还是<a href="https://www.themoviedb.org/tv/60957"><code>那个男人</code></a></p><h1 id="刷机"><a href="#刷机" class="headerlink" title="刷机"></a>刷机</h1><p>从 <a href="https://www.znds.com/tv-617019-1-1.html">https://www.znds.com/tv-617019-1-1.html</a> 下载 <code>8H73_M5_V016.011.171_9_5.5.zip</code> 后放到 <code>fat32</code>格式的<code>u盘</code>根目录</p><p>长按电源键 等待亮屏后又再次亮屏时松开</p><p>进入 <code>recovery</code> 模式 先 <code>双清</code> 再 <code>升级</code> 即可</p><h1 id="首次开启-adb"><a href="#首次开启-adb" class="headerlink" title="首次开启 adb"></a>首次开启 <code>adb</code></h1><p>在 设置 的 关于系统 页面</p><p>按 <code>⬆️⬆️⬇️⬇️⬅️➡️⬅️➡️</code> 进入 <code>工厂模式</code></p><p>里面 <code>全部设置</code> <code>其他</code> <code>开启adb</code></p><h1 id="解锁-root"><a href="#解锁-root" class="headerlink" title="解锁 root"></a>解锁 <code>root</code></h1><p>下载 <a href="https://www.kingoapp.com/">kingo root</a> 即可</p><p>使用 <code>adb install</code> 安装后</p><p>电视机打开等待3分钟左右解锁<code>root</code></p><h1 id="adb-相关"><a href="#adb-相关" class="headerlink" title="adb 相关"></a><code>adb</code> 相关</h1><h2 id="自动开启"><a href="#自动开启" class="headerlink" title="自动开启"></a>自动开启</h2><p>修改 <code>/system/build.prop</code></p><ul><li><code>persist.sys.openadb=1</code></li></ul><h2 id="再连接时候-shell-Read-only-file-system"><a href="#再连接时候-shell-Read-only-file-system" class="headerlink" title="再连接时候 shell Read only file system"></a>再连接时候 <code>shell</code> <a href="https://stackoverflow.com/a/8534641/6686061"><code>Read only file system</code></a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o rw,remount /system</span><br></pre></td></tr></table></figure><h2 id="push-时"><a href="#push-时" class="headerlink" title="push 时"></a><code>push</code> 时</h2><p>可以将文件 <code>push</code> 到 <code>/data/local/tmp/</code> 这个目录<br>再进入 <code>shell</code> <code>cp</code> <code>chmod</code></p><h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><p>安装 <code>Solid Explorer</code> 将 有图标 能看懂的应用 删除即可</p><h1 id="桌面"><a href="#桌面" class="headerlink" title="桌面"></a>桌面</h1><ul><li>使用 <code>当贝桌面</code> <code>com.dangbei.tvlauncher</code></li></ul><p>修改 <code>/system/pcfg/8H73_M5/config/general_config.xml</code></p><ul><li><code>&lt;config name=&quot;DEFAULT_HOMEPAGE&quot; value = &quot;com.dangbei.tvlauncher/com.dangbei.tvlauncher.IndexActivity&quot;/&gt;</code></li></ul><p>将<code>apk</code> 放到 <code>system/app</code> 目录中 不然会卡开机</p><h1 id="DLNA-投屏"><a href="#DLNA-投屏" class="headerlink" title="DLNA 投屏"></a><code>DLNA</code> 投屏</h1><p>可以使用 <code>橙子投屏</code></p><h1 id="EMBY-使用"><a href="#EMBY-使用" class="headerlink" title="EMBY 使用"></a><code>EMBY</code> 使用</h1><p>这是最后一个支持安卓版本 <code>4.4.2</code> 的</p><ul><li><a href="https://www.apkmirror.com/apk/emby-media/emby-for-android/emby-for-android-3-0-21-release/">https://www.apkmirror.com/apk/emby-media/emby-for-android/emby-for-android-3-0-21-release/</a></li></ul><p>硬件问题 <code>HDR</code> 的视频是无法播放的</p>]]></content>
    
    
    <summary type="html">给 创维 8H73_M5 的优化记录</summary>
    
    
    
    
    <category term="Android" scheme="https://puzzle9.github.io/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>btrfs</title>
    <link href="https://puzzle9.github.io/posts/6c53b462/"/>
    <id>https://puzzle9.github.io/posts/6c53b462/</id>
    <published>2025-05-14T04:45:43.000Z</published>
    <updated>2025-05-14T05:08:36.267Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>把主力机换成<code>arch</code>的那两三事</p></blockquote><p>要说这个好 那就好的不得了</p><p>首先 要有 <a href="https://archlinux.org/packages/core/x86_64/btrfs-progs/"><code>btrfs-progs</code></a> 这个包</p><p>其次 要有 <code>btrfs</code> 的文件系统 <code>mkfs.btrfs -L Arch /dev/sdxn</code></p><p>再者 要能访问 <code>mount /dev/sdxn /btrfs</code></p><h1 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h1><p>一种是挂载 <code>分区</code></p><p>这时候可以对 <code>子卷</code> 进行操作</p><p>另一种是挂载 <code>子卷</code></p><p>这时候可以堆 <code>子卷</code> 的文件进行操作 虽让上面那种挂载也行</p><h1 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先挂载</span></span><br><span class="line">mount --<span class="built_in">mkdir</span> /dev/sdxn /btrfs</span><br><span class="line"><span class="built_in">cd</span> /btrfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出子卷列表</span></span><br><span class="line">btrfs subvolume list .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建子卷</span></span><br><span class="line">btrfs subvolume create @vm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除子卷</span></span><br><span class="line">btrfs subvolume delete @vm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 快照子卷</span></span><br><span class="line">btrfs subvolume snapshot @vm @vm_bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令也可以精简</span></span><br><span class="line"><span class="comment"># btrfs sub snap ...</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mount -t btrfs -o subvol=@vm,noatime,compress=zstd:1 /dev/sdxn /archlinux/vm</span><br><span class="line">mount -t btrfs -o subvol=@home,noatime,compress=lzo /dev/sdxn /archlinux/home</span><br><span class="line">mount -t btrfs -o subvol=@var_cache,noatime,nodatacow /dev/sdxn /archlinux/var/cache</span><br><span class="line">mount -t btrfs -o subvol=@var_log,noatime,nodatacow /dev/sdxn /archlinux/var/log</span><br></pre></td></tr></table></figure><ul><li><code>nodatacow</code> 关闭 <code>cow</code> 功能</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出属性</span></span><br><span class="line">lsattr .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对某个文件关闭cow</span></span><br><span class="line">chattr +C [path]</span><br></pre></td></tr></table></figure><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>还在寻找答案中</p><p>linux btrf 同一个卷中<br>有以下三种挂载方式<br>rw,noatime,compress&#x3D;zstd:1,subvol&#x3D;&#x2F;@<br>rw,noatime,compress&#x3D;lzo,subvol&#x3D;&#x2F;@home<br>rw,noatime,nodatacow,subvol&#x3D;&#x2F;@opt</p><p>把a文件从@移动到@home时候 文件压缩类型变化吗<br>把b文件从@移动到@opt时候 文件用到了cow了吗<br>把c文件从@opt移动到了@opt 文件用到cow了吗<br>把d文件从@opt移动到了@home 文件用到cow了吗<br>如何判断一个文件是否用到了cow</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;把主力机换成&lt;code&gt;arch&lt;/code&gt;的那两三事&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;要说这个好 那就好的不得了&lt;/p&gt;
&lt;p&gt;首先 要有 &lt;a href=&quot;https://archlinux.org/packages/core/x8</summary>
      
    
    
    
    <category term="btrfs" scheme="https://puzzle9.github.io/categories/btrfs/"/>
    
    
    <category term="linux" scheme="https://puzzle9.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>libvirt 初探</title>
    <link href="https://puzzle9.github.io/posts/9c0bfbd/"/>
    <id>https://puzzle9.github.io/posts/9c0bfbd/</id>
    <published>2025-05-11T06:47:38.000Z</published>
    <updated>2025-05-27T18:07:36.816Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>把主力机换成<code>arch</code>的那两三事</p></blockquote><h1 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h1><ul><li><code>kvm</code> 是底层虚拟化 提供 <code>cpu</code> <code>内存</code> 等</li><li><code>qemu</code> 是基于 <code>kvm</code> 管理外设的 <code>网卡</code> <code>硬盘</code> 等</li><li><code>libvirt</code> 是基于前两个的 <code>终端命令</code></li><li><code>virt-manager</code> 是基于 <code>libvirt</code> 的 <code>gui</code> 页面</li><li><code>virt-viewer</code> 是基于 <code>spice</code> 协议的 远程连接软件 将 <code>virt-manager</code> 这部分功能独立出来了</li></ul><h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><ul><li><code>主机 host</code> <code>提供虚拟化的机器</code></li><li><code>客户机 guest</code> <code>使用虚拟化的机器</code></li></ul><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>如果使用 <code>btrfs</code> 的话<br>建议把 <code>/var/lib/libvirt/</code> 先做个子卷 并设置为 <code>nodatacow</code> 属性</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pacman -S qemu-desktop libvirt virt-manager dnsmasq</span><br><span class="line">systemctl <span class="built_in">enable</span> libvirtd --now</span><br></pre></td></tr></table></figure><h2 id="修改权限"><a href="#修改权限" class="headerlink" title="修改权限"></a>修改权限</h2><ul><li><code>/etc/libvirt/libvirtd.conf</code> 取消注释 <code>unix_sock_group</code> 和 <code>unix_sock_ro_perms</code></li><li><code>usermod -aG libvirt [who]</code> 将自己添加到用户组</li></ul><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>打开 <code>virt-manager</code></p><p>开启 <code>xml</code> 编辑功能</p><h2 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h2><p>保险期间期间 使用 <code>nat</code> 或者 <code>隔离</code></p><p>网段可为 <code>192.168.26.0/28</code></p><h2 id="kvm"><a href="#kvm" class="headerlink" title="kvm"></a>kvm</h2><p>连接为 <code>qemu:///system</code></p><p>外设模式都选 <code>virtio</code> 再删除不用的外设</p><p>使用 <code>qcow2</code> 模式镜像 <code>快照</code> <code>派生</code> 等功能很棒</p><h3 id="win10-or-win11"><a href="#win10-or-win11" class="headerlink" title="win10 or win11"></a>win10 or win11</h3><p>推荐用 <code>Windows 10 IoT Enterprise LTSC 2021</code> 或 <code>Windows 11 IoT Enterprise LTSC 2024</code> <a href="https://massgrave.dev/windows_ltsc_links">镜像</a></p><p>一定要加载 <a href="https://aur.archlinux.org/packages/virtio-win"><code>virtio-win</code></a> <a href="https://docs.fedoraproject.org/en-US/quick-docs/creating-windows-virtual-machines-using-virtio-drivers/index.html">镜像</a></p><p>安装时 必须将 <a href="https://superuser.com/a/948591/1173085"><strong>硬盘设为第一启动项</strong></a></p><p><del>用pe应该也可以搞 我曾经想试过</del></p><p>用 <a href="https://firpe.cn/">pe</a> 加载 驱动后 安装时再把驱动内置进去就成</p><h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><ul><li><p>使用 <code>host-passthrough</code> 模式</p></li><li><p><a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#CPU_pinning">定住<code>cpu</code></a></p></li><li><p>关闭休眠 <code>powercfg -h off</code></p></li><li><p>禁用 <code>SysMain</code> <code>Search</code> 等服务</p></li><li><p>删除 <code>定时任务</code></p></li><li><p><a href="https://github.com/tsgrgo/windows-update-disabler">禁止 <code>update</code> 啦</a></p></li><li><p><a href="https://github.com/ionuttbara/windows-defender-remover">移除 <code>defender</code> 啦</a></p></li></ul><h5 id="win10-lts-wsappx-cpu占用高"><a href="#win10-lts-wsappx-cpu占用高" class="headerlink" title="win10 lts wsappx cpu占用高"></a>win10 lts wsappx cpu占用高</h5><ul><li><a href="https://github.com/brokyz/Win10_LTSC_2021_FixPacks">https://github.com/brokyz/Win10_LTSC_2021_FixPacks</a></li></ul><h5 id="win11-修改为-win10-的右键菜单"><a href="#win11-修改为-win10-的右键菜单" class="headerlink" title="win11 修改为 win10 的右键菜单"></a>win11 修改为 win10 的右键菜单</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg.exe add &quot;HKCU\Software\Classes\CLSID\&#123;86ca1aa0-34aa-4e8b-a509-50c905bae2a2&#125;\InprocServer32&quot; /f /ve</span><br></pre></td></tr></table></figure><h4 id="使用-virtiofs-文件共享"><a href="#使用-virtiofs-文件共享" class="headerlink" title="使用 virtiofs 文件共享"></a>使用 <a href="https://virtio-fs.gitlab.io/howto-windows.html"><code>virtiofs</code></a> 文件共享</h4><blockquote><p>这个共享吧 有些软件他不支持!</p></blockquote><p>需要安装 <a href="https://github.com/winfsp/winfsp"><code>WinFsp</code></a> 后 并手动开启 <code>VirtioFsSvc</code> 服务</p><p>这种模式只支持一个文件夹</p><p>如需多种共享参考 <a href="https://github.com/virtio-win/kvm-guest-drivers-windows/wiki/Virtiofs:-Shared-file-system#mount">wiki</a></p><h4 id="gpu-共享"><a href="#gpu-共享" class="headerlink" title="gpu 共享"></a><code>gpu</code> 共享</h4><h5 id="使用-vgpu"><a href="#使用-vgpu" class="headerlink" title="使用 vgpu"></a>使用 <code>vgpu</code></h5><p>我在 <code>arch 6.12.28-1-lts</code> 上一直失败 但在 <code>debian 13</code> 是成功的 便放弃了</p><ul><li><a href="https://gitlab.com/polloloco/vgpu-proxmox">https://gitlab.com/polloloco/vgpu-proxmox</a></li><li><a href="https://foxi.buduanwang.vip/virtualization/pve/3417.html">https://foxi.buduanwang.vip/virtualization/pve/3417.html</a></li><li><a href="https://alist.homelabproject.cc/foxipan">https://alist.homelabproject.cc/foxipan</a></li></ul><h5 id="直通-gpu"><a href="#直通-gpu" class="headerlink" title="直通 gpu"></a>直通 <code>gpu</code></h5><p>添加 <code>pci</code> 后</p><p>去 <a href="https://www.nvidia.cn/drivers/lookup/"><code>nvidia</code></a> 下载 驱动 他们就名字不一样</p><p>只需要安装 <code>精简</code> 那个模式就行</p><p>由于 <code>win</code> 显卡无输出 所以他不会用 <code>gpu</code> 的 神奇吧</p><p>这里就牵扯到两个方案啦</p><h6 id="hdmi显卡欺骗器"><a href="#hdmi显卡欺骗器" class="headerlink" title="hdmi显卡欺骗器"></a>hdmi显卡欺骗器</h6><p>笔记本中不现实 放弃</p><h6 id="虚拟屏幕"><a href="#虚拟屏幕" class="headerlink" title="虚拟屏幕"></a><a href="https://github.com/VirtualDisplay/Virtual-Display-Driver">虚拟屏幕</a></h6><p>需要安装 <a href="https://dotnet.microsoft.com/en-us/download/dotnet/thank-you/runtime-desktop-6.0.36-windows-x64-installer"><code>windowsdesktop-runtime-6.0.x-win-x64.exe</code></a></p><p>安装后有可能设备启动失败 在设备管理器中看看可以手动启用不 不得行就换 <code>win11</code> 吧</p><p>可以修改 安装目录的 <a href="https://github.com/VirtualDrivers/Virtual-Display-Driver/wiki/How-to-configure-the-driver#overview-of-the-configuration-xml"><code>vdd_settings.xml</code></a> 文件自定义分辨率等</p><hr><p>那解决了显卡无输出问题后 下个问题就光明正大的来啦</p><p>那要如何显示这个虚拟屏幕呢?</p><p>这时候 <a href="https://looking-glass.io/"><code>Looking Glass</code></a> 就来啦</p><p>安装 <a href="https://aur.archlinux.org/packages/looking-glass"><code>looking-glass-client</code></a></p><p>再参考 <a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Using_Looking_Glass_to_stream_guest_screen_to_the_host"><code>wiki</code></a> 配置下</p><p>将 <code>looking-glass</code> 的显存可以调大点 比如 <code>128</code></p><p>在 <code>客户机</code> 上将虚拟屏幕设为唯一显示</p><p>出问题了可以按 <code>win + p</code> 凭记忆修改显示屏幕</p><p>主机上运行 <code>looking-glass-client -m 97 -F</code> 即可启动</p><ul><li><code>-F</code> 全屏</li><li><code>-m</code> 指定主机键 <code>97</code> 这里是 <code>lctrl</code></li></ul><p>出了意外的话 看 <code>%ProgramData%\Looking Glass (host)\looking-glass-host.txt</code> 日志</p><p>来张 <em>索拉卡前的对比图</em></p><p><img src="/posts/9c0bfbd/lol_soraka_befor.png" alt="lol_soraka_befor"></p><h4 id="删除-win-的恢复分区"><a href="#删除-win-的恢复分区" class="headerlink" title="删除 win 的恢复分区"></a><a href="https://superuser.com/a/1824309/1173085">删除 win 的恢复分区</a></h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">diskpart</span><br><span class="line">list disk</span><br><span class="line">select disk [number]</span><br><span class="line">list partition</span><br><span class="line">select partition [number]</span><br><span class="line">delete partition override</span><br><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure><h4 id="开启-TPM-支持"><a href="#开启-TPM-支持" class="headerlink" title="开启 TPM 支持"></a>开启 <code>TPM</code> 支持</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S swtpm</span><br></pre></td></tr></table></figure><h4 id="同步主机分辨率"><a href="#同步主机分辨率" class="headerlink" title="同步主机分辨率"></a>同步主机分辨率</h4><p>首次可以同步 全屏和修改有点问题</p><p>可以在设备管理器中 重启 <code>Red Hat VirtIO GPU DOD controller</code> 解决</p><h3 id="qcow2-的-高级使用"><a href="#qcow2-的-高级使用" class="headerlink" title="qcow2 的 高级使用"></a><code>qcow2</code> 的 高级使用</h3><ul><li>q -&gt; qume</li><li>cow -&gt; 写时复制</li><li>2 -&gt; 第二版本?</li></ul><p>这个快照是线性的</p><h4 id="快照合并"><a href="#快照合并" class="headerlink" title="快照合并"></a>快照合并</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qemu-img convert -O qcow2 origin save</span><br><span class="line">qemu-img convert -O qcow2 base.qcow2 new.qcow2</span><br></pre></td></tr></table></figure><h4 id="镜像派生"><a href="#镜像派生" class="headerlink" title="镜像派生"></a>镜像派生</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qemu-img create -F qcow2 -f qcow2 save -o backing_file=origin size</span><br><span class="line">qemu-img create -F qcow2 -f qcow2 new.qcow2 -o backing_file=/base.qcow2 200G</span><br></pre></td></tr></table></figure><h4 id="镜像修改"><a href="#镜像修改" class="headerlink" title="镜像修改"></a>镜像修改</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">modprobe nbd</span><br><span class="line">qemu-nbd -c /dev/nbd0 base.qcow2</span><br><span class="line">qemu-nbd -d /dev/nbd0</span><br></pre></td></tr></table></figure><h2 id="lxc"><a href="#lxc" class="headerlink" title="lxc"></a>lxc</h2><p>连接为 <code>lxc:///</code></p><p>这个是自己实现的 <code>lxc</code> 无须安装其他的包</p><p>可以直接用 <code>rootfs</code></p><p>或者在 <a href="https://images.linuxcontainers.org/">https://images.linuxcontainers.org/</a> 下载</p><p>先 <code>chroot</code> 进去修改 密码</p><h3 id="alpine"><a href="#alpine" class="headerlink" title="alpine"></a>alpine</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chroot</span> alpine /bin/sh -l</span><br></pre></td></tr></table></figure><p>再者 推荐使用 <code>dropbear</code> 来节省点 <code>内存</code></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://wiki.archlinux.org/title/Libvirt">https://wiki.archlinux.org/title/Libvirt</a></li><li><a href="https://wiki.archlinux.org/title/Virt-manager">https://wiki.archlinux.org/title/Virt-manager</a></li><li><a href="https://wiki.archlinux.org/title/QEMU">https://wiki.archlinux.org/title/QEMU</a></li><li><a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF">https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF</a></li><li><a href="https://sysguides.com/install-a-windows-11-virtual-machine-on-kvm">https://sysguides.com/install-a-windows-11-virtual-machine-on-kvm</a></li><li><a href="https://zhuanlan.zhihu.com/p/24366335">https://zhuanlan.zhihu.com/p/24366335</a></li><li><a href="https://zhuanlan.zhihu.com/p/600611659">https://zhuanlan.zhihu.com/p/600611659</a></li><li><a href="https://ivonblog.com/posts/looking-glass-host-for-windows/">https://ivonblog.com/posts/looking-glass-host-for-windows/</a></li><li><a href="https://blog.gavinzh.com/2017/08/02/qemu-img-tutorial-commands/">https://blog.gavinzh.com/2017/08/02/qemu-img-tutorial-commands/</a></li></ul>]]></content>
    
    
    <summary type="html">linux 虚拟化 kvm qemu</summary>
    
    
    
    <category term="libvirt" scheme="https://puzzle9.github.io/categories/libvirt/"/>
    
    
    <category term="linux" scheme="https://puzzle9.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>vite 的 target 呀</title>
    <link href="https://puzzle9.github.io/posts/97f3c987/"/>
    <id>https://puzzle9.github.io/posts/97f3c987/</id>
    <published>2024-11-19T13:41:38.000Z</published>
    <updated>2025-05-11T06:12:58.235Z</updated>
    
    <content type="html"><![CDATA[<p>恩 浏览器兼容 换赛道了呢</p><p>好久没升级的我遇到了 <code>Object.hasOwn is not a function</code> 错误</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mozilla/5.0 (Linux; Android 12; 2112123AG Build/SKQ1.220303.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/86.0.4240.99 XWEB/4263 MMWEBSDK/20220604 Mobile Safari/537.36 MMWEBID/2083 MicroMessenger/8.0.24.2167(0x28001843) WeChat/arm64 Weixin GPVersion/1 NetType/WIFI Language/zh_CN ABI/arm64  </span><br></pre></td></tr></table></figure><p>看了看应用的包 发现 <code>ky</code> 这个现代的有趣家伙</p><p>恩 搜了搜 发现优雅的解决方案</p><p><code>main.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> hasOwn <span class="keyword">from</span> <span class="string">&#x27;object.hasown&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">Object</span>.<span class="property">hasOwn</span>) &#123;</span><br><span class="line">  hasOwn.<span class="title function_">shim</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考地址</p><ul><li><a href="https://github.com/sindresorhus/ky/issues/629">https://github.com/sindresorhus/ky/issues/629</a></li><li><a href="https://github.com/vitejs/vite/discussions/15794">https://github.com/vitejs/vite/discussions/15794</a></li><li><a href="https://ccny.ltd/views/blog/2022/%E4%BB%8E%20Object.hasOwn%20%E7%9C%8B%20@vitejs_plugin-legacy.html">https://ccny.ltd/views/blog/2022/%E4%BB%8E%20Object.hasOwn%20%E7%9C%8B%20@vitejs_plugin-legacy.html</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;恩 浏览器兼容 换赛道了呢&lt;/p&gt;
&lt;p&gt;好久没升级的我遇到了 &lt;code&gt;Object.hasOwn is not a function&lt;/code&gt; 错误&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cl</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>UA 列表收集</title>
    <link href="https://puzzle9.github.io/posts/44f49894/"/>
    <id>https://puzzle9.github.io/posts/44f49894/</id>
    <published>2024-10-22T07:52:35.000Z</published>
    <updated>2025-05-11T06:12:58.235Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p><code>Mozilla/5.0 (Linux; Android 12; 2112123AG Build/SKQ1.220303.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/86.0.4240.99 XWEB/4263 MMWEBSDK/20220604 Mobile Safari/537.36 MMWEBID/2083 MicroMessenger/8.0.24.2167(0x28001843) WeChat/arm64 Weixin GPVersion/1 NetType/WIFI Language/zh_CN ABI/arm64</code></p></li><li><p><code>Mozilla/5.0 (Linux; U; Android 13; zh-cn; 21091116AC Build/TP1A.220624.014) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/109.0.5414.118 Mobile Safari/537.36 XiaoMi/MiuiBrowser/18.4.410719</code></p></li><li><p><code>Mozilla/5.0 (Linux; Android 13; 21091116AC Build/TP1A.220624.014; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/126.0.6478.188 Mobile Safari/537.36 XWEB/1260117 MMWEBSDK/20240501 MMWEBID/8157 MicroMessenger/8.0.50.2701(0x2800325B) WeChat/arm64 Weixin NetType/4G Language/zh_CN ABI/arm64</code></p></li><li><p><code>Mozilla/5.0 (iPhone; CPU iPhone OS 14_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 MicroMessenger/8.0.52(0x18003425) NetType/WIFI Language/zh_CN</code></p></li><li><p><code>Mozilla/5.0 (iPhone; CPU iPhone OS 14_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.1 Mobile/15E148 Safari/604.1</code></p></li></ul><p>&#96;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;Mozilla/5.0 (Linux; Android 12; 2112123AG Build/SKQ1.220303.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Ch</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>命令 **技巧</title>
    <link href="https://puzzle9.github.io/posts/6c5b1981/"/>
    <id>https://puzzle9.github.io/posts/6c5b1981/</id>
    <published>2024-10-22T07:51:50.000Z</published>
    <updated>2025-07-09T09:30:34.485Z</updated>
    
    <content type="html"><![CDATA[<h1 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> &#123;http,https&#125;_proxy=<span class="string">&quot;http://ip:port&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> http_proxy=http://ip:port</span><br><span class="line"><span class="built_in">set</span> https_proxy=http://ip:port</span><br></pre></td></tr></table></figure><h1 id="mariadb"><a href="#mariadb" class="headerlink" title="mariadb"></a>mariadb</h1><h2 id="debian"><a href="#debian" class="headerlink" title="debian"></a>debian</h2><ul><li><a href="https://mariadb.com/kb/en/installing-mariadb-deb-files/">https://mariadb.com/kb/en/installing-mariadb-deb-files/</a></li><li><a href="https://swmlee.com/2020/06/18/technicalessays/mariadbseries/07mariadb-performance-optimization/">https://swmlee.com/2020/06/18/technicalessays/mariadbseries/07mariadb-performance-optimization/</a></li><li><a href="https://www.cnblogs.com/dh17/p/14484423.html">https://www.cnblogs.com/dh17/p/14484423.html</a></li><li><a href="https://stackoverflow.com/a/19101356/6686061">https://stackoverflow.com/a/19101356/6686061</a></li><li><a href="https://github.com/major/MySQLTuner-perl">https://github.com/major/MySQLTuner-perl</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https://downloads.mariadb.com/MariaDB/mariadb_repo_setup | bash</span><br><span class="line">apt install mariadb-server</span><br><span class="line">systemctl <span class="built_in">enable</span> mariadb --now</span><br><span class="line"></span><br><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><p><code>/etc/mysql/mariadb.conf.d/10-custom.cnf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-name-resolve=ON</span><br><span class="line">performance_schema=ON</span><br><span class="line">innodb_buffer_pool_size=512M</span><br><span class="line">innodb_log_file_size=128M</span><br><span class="line">innodb_log_buffer_size=256M</span><br><span class="line"></span><br><span class="line">slow-query-log=1</span><br><span class="line">slow-query-log-file=/var/log/mysql-slow.log</span><br><span class="line">long_query_time=2</span><br><span class="line"></span><br><span class="line">query_cache_type=ON</span><br><span class="line">query_cache_size=256M</span><br></pre></td></tr></table></figure><h2 id="alpine"><a href="#alpine" class="headerlink" title="alpine"></a>alpine</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apk add mariadb mariadb-client</span><br><span class="line">/etc/init.d/mariadb setup</span><br><span class="line">rc-service mariadb start</span><br><span class="line">rc-update add mariadb default</span><br><span class="line">mariadb-secure-installation</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE `database`;</span><br><span class="line"></span><br><span class="line">CREATE USER &#x27;user&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;password&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO user@&#x27;%&#x27; IDENTIFIED BY &#x27;password&#x27; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON `database`.* TO &#x27;user&#x27;@&#x27;%&#x27;;</span><br><span class="line"></span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show status like &#x27;%Qcache%&#x27;;</span><br><span class="line">show variables like &quot;%query_cache%&quot;</span><br></pre></td></tr></table></figure><h1 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h1><h2 id="debian-1"><a href="#debian-1" class="headerlink" title="debian"></a>debian</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apt-get install lsb-release curl gpg</span><br><span class="line">curl -fsSL https://packages.redis.io/gpg | gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg</span><br><span class="line"><span class="built_in">chmod</span> 644 /usr/share/keyrings/redis-archive-keyring.gpg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb <span class="subst">$(lsb_release -cs)</span> main&quot;</span> | <span class="built_in">tee</span> /etc/apt/sources.list.d/redis.list</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install redis</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> redis-server --now</span><br></pre></td></tr></table></figure><h1 id="caddy"><a href="#caddy" class="headerlink" title="caddy"></a>caddy</h1><ul><li><a href="https://caddyserver.com/docs/install">https://caddyserver.com/docs/install</a></li><li><a href="https://gist.github.com/ryanburnette/d13575c9ced201e73f8169d3a793c1a3">https://gist.github.com/ryanburnette/d13575c9ced201e73f8169d3a793c1a3</a></li></ul><h2 id="debian-2"><a href="#debian-2" class="headerlink" title="debian"></a>debian</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt install -y debian-keyring debian-archive-keyring apt-transport-https curl</span><br><span class="line">curl -1sLf <span class="string">&#x27;https://dl.cloudsmith.io/public/caddy/stable/gpg.key&#x27;</span> | gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg</span><br><span class="line">curl -1sLf <span class="string">&#x27;https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt&#x27;</span> | <span class="built_in">tee</span> /etc/apt/sources.list.d/caddy-stable.list</span><br><span class="line">apt update</span><br><span class="line">apt install caddy</span><br><span class="line">systemctl <span class="built_in">enable</span> caddy --now</span><br></pre></td></tr></table></figure><h2 id="alpine-1"><a href="#alpine-1" class="headerlink" title="alpine"></a>alpine</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apk add caddy</span><br><span class="line">rc-update add caddy</span><br><span class="line">rc-service caddy restart</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">(cors) &#123;</span><br><span class="line">  @cors_preflight method OPTIONS</span><br><span class="line">  @cors header Origin &#123;args.0&#125;</span><br><span class="line"></span><br><span class="line">  handle @cors_preflight &#123;</span><br><span class="line">    header Access-Control-Allow-Origin &quot;&#123;args.0&#125;&quot;</span><br><span class="line">    header Access-Control-Allow-Methods *</span><br><span class="line">    header Access-Control-Allow-Headers *</span><br><span class="line">    header Access-Control-Max-Age &quot;3600&quot;</span><br><span class="line">    respond &quot;&quot; 204</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handle @cors &#123;</span><br><span class="line">    header Access-Control-Allow-Origin &quot;&#123;args.0&#125;&quot;</span><br><span class="line">    header Access-Control-Expose-Headers *</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">import /data/conf/*.caddy</span><br><span class="line"></span><br><span class="line">:80 &#123;</span><br><span class="line">  root * /usr/share/caddy</span><br><span class="line">  file_server</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">domain.com &#123;</span><br><span class="line">  encode zstd gzip</span><br><span class="line">  tls domain@email</span><br><span class="line"></span><br><span class="line">  import cors http://domain.com</span><br><span class="line">  reverse_proxy 127.0.0.1:6001</span><br><span class="line"></span><br><span class="line">  log &#123;</span><br><span class="line">    output file /data/logs/domain.log</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">domain.com:80 &#123;</span><br><span class="line">  encode zstd gzip</span><br><span class="line"></span><br><span class="line">  root * /data/www//dist</span><br><span class="line">  try_files &#123;path&#125; /index.html</span><br><span class="line">  file_server</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reverse_proxy 127.0.0.1:4050 &#123;</span><br><span class="line">  header_up X-Real-IP &#123;remote&#125;</span><br><span class="line">  handle_response &#123;</span><br><span class="line">    header Access-Control-Allow-Origin *</span><br><span class="line">    header Access-Control-Allow-Methods *</span><br><span class="line">    header Access-Control-Allow-Headers *</span><br><span class="line">    header Access-Control-Max-Age 3600</span><br><span class="line">    copy_response</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">log &#123;</span><br><span class="line">  output file /data/logs/log.log</span><br><span class="line"></span><br><span class="line">  format console &#123;</span><br><span class="line">    time_format wall</span><br><span class="line">    time_local</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">handle_path /logs/* &#123;</span><br><span class="line">  root * /data/www/logs/</span><br><span class="line">  file_server browse &#123;</span><br><span class="line">    precompressed zstd br gzip</span><br><span class="line">    hide &quot;.gitignore&quot; &quot;*.json&quot; &quot;supervisord*&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="supervisor"><a href="#supervisor" class="headerlink" title="supervisor"></a>supervisor</h1><h2 id="debian-3"><a href="#debian-3" class="headerlink" title="debian"></a>debian</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install supervisor</span><br><span class="line">systemctl <span class="built_in">enable</span> supervisor --now</span><br></pre></td></tr></table></figure><h2 id="alpine-2"><a href="#alpine-2" class="headerlink" title="alpine"></a>alpine</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apk add supervisor</span><br><span class="line">rc-update add supervisord</span><br><span class="line">rc-service supervisord restart</span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/supervisor.d/</span><br></pre></td></tr></table></figure><h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https://deb.nodesource.com/setup_lts.x | bash</span><br><span class="line">apt install nodejs</span><br><span class="line"></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmmirror.com</span><br><span class="line"></span><br><span class="line">npm install -g pnpm</span><br></pre></td></tr></table></figure><h1 id="git"><a href="#git" class="headerlink" title="git"></a>git</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git config core.filemode <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">git daemon --verbose --export-all --base-path=.</span><br><span class="line">git <span class="built_in">clone</span> git://127.0.0.1/file file</span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> ../base/file file</span><br></pre></td></tr></table></figure><h1 id="pake"><a href="#pake" class="headerlink" title="pake"></a>pake</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pake http://domain.test --name domain --icon favicon_128.ico --fullscreen --always-on-top --installer-language zh-CN</span><br><span class="line">pake http://domain-dev.test --name domain-dev --icon favicon_128.ico --installer-language zh-CN --debug</span><br></pre></td></tr></table></figure><h1 id="php"><a href="#php" class="headerlink" title="php"></a>php</h1><h2 id="frankenphp"><a href="#frankenphp" class="headerlink" title="frankenphp"></a>frankenphp</h2><ul><li><a href="https://github.com/dunglas/frankenphp">https://github.com/dunglas/frankenphp</a></li><li><a href="https://frankenphp.dev/docs/known-issues/#composer-scripts-referencing-php">https://frankenphp.dev/docs/known-issues/#composer-scripts-referencing-php</a></li><li><a href="https://mirrors.tencent.com/help/composer.html">https://mirrors.tencent.com/help/composer.html</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/dunglas/frankenphp/releases/download/v1.3.1/frankenphp-linux-x86_64</span><br><span class="line"><span class="built_in">chmod</span> +x frankenphp-linux-x86_64</span><br><span class="line"><span class="built_in">mv</span> frankenphp-linux-x86_64 /usr/local/bin</span><br></pre></td></tr></table></figure><p><code>/usr/local/bin/php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">args=(<span class="string">&quot;<span class="variable">$@</span>&quot;</span>)</span><br><span class="line">index=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$i</span>&quot;</span> == <span class="string">&quot;-d&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">unset</span> <span class="string">&#x27;args[$index]&#x27;</span></span><br><span class="line">        <span class="built_in">unset</span> <span class="string">&#x27;args[$index+1]&#x27;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    index=$((index+<span class="number">1</span>))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">/usr/local/bin/frankenphp php-cli <span class="variable">$&#123;args[@]&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frankenphp php-cli /usr/local/bin/composer  install --no-dev -vvv</span><br></pre></td></tr></table></figure><h2 id="composer"><a href="#composer" class="headerlink" title="composer"></a>composer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.tencent.com/composer/composer.phar</span><br><span class="line"><span class="built_in">mv</span> composer.phar /usr/local/bin/composer</span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/composer</span><br><span class="line">composer config -g repos.packagist composer https://mirrors.tencent.com/composer/</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer install --no-dev -vvv</span><br></pre></td></tr></table></figure><h2 id="laravel"><a href="#laravel" class="headerlink" title="laravel"></a>laravel</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan key:generate</span><br></pre></td></tr></table></figure><h1 id="win"><a href="#win" class="headerlink" title="win"></a>win</h1><ul><li><a href="https://github.com/TGSAN/CMWTAT_Digital_Edition/issues/81">https://github.com/TGSAN/CMWTAT_Digital_Edition/issues/81</a></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">irm</span> https://massgrave.dev/get | <span class="built_in">iex</span></span><br></pre></td></tr></table></figure><h1 id="alpine-3"><a href="#alpine-3" class="headerlink" title="alpine"></a>alpine</h1><ul><li><a href="https://stackoverflow.com/a/62218241/6686061">https://stackoverflow.com/a/62218241/6686061</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN apk add name --repository=http://dl-cdn.alpinelinux.org/alpine/edge/testing/</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apk add openssh</span><br><span class="line">rc-update add sshd</span><br></pre></td></tr></table></figure><h1 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h1><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><h3 id="debian-4"><a href="#debian-4" class="headerlink" title="debian"></a>debian</h3><ul><li><a href="https://docs.docker.com/engine/install/debian/">https://docs.docker.com/engine/install/debian/</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install ca-certificates curl</span><br><span class="line">install -m 0755 -d /etc/apt/keyrings</span><br><span class="line">curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc</span><br><span class="line"><span class="built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \</span></span><br><span class="line"><span class="string">  <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$VERSION_CODENAME</span>&quot;</span>)</span> stable&quot;</span> | \</span><br><span class="line"> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure><h2 id="image"><a href="#image" class="headerlink" title="image"></a>image</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># save image</span></span><br><span class="line">docker save puzzle9/image:latest | gzip  &gt; puzzle9_image-latest.tar.gz</span><br><span class="line"><span class="comment"># load image</span></span><br><span class="line">gunzip -c puzzle9_image-latest.tar.gz | docker load</span><br></pre></td></tr></table></figure><h2 id="role"><a href="#role" class="headerlink" title="role"></a>role</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -e HTTP_PROXY=http://127.0.0.1:3128 -e HTTPS_PROXY=http://127.0.0.1:3128 -it --<span class="built_in">rm</span> --name build_web -v ./web:/app -w /app node:20-alpine npm install</span><br><span class="line"></span><br><span class="line">docker run --net=host -it --<span class="built_in">rm</span> --name build_web -v <span class="string">&quot;<span class="variable">$PWD</span>&quot;</span>:/app -w /app node:20-alpine npm install --proxy http://127.0.0.1:3128/</span><br></pre></td></tr></table></figure><h1 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -xvf file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包</span></span><br><span class="line">tar -cvf file.tar files</span><br><span class="line">tar -czvf file.tar.gz files</span><br></pre></td></tr></table></figure><h1 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip route add 192.168.21.0/24 via 192.168.2.9</span><br><span class="line">ip route del 192.168.21.0/24 via 192.168.2.9</span><br></pre></td></tr></table></figure><h1 id="ssh-key"><a href="#ssh-key" class="headerlink" title="ssh key"></a>ssh key</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519</span><br></pre></td></tr></table></figure><h1 id="清空网卡已获取到的ip并重新获取"><a href="#清空网卡已获取到的ip并重新获取" class="headerlink" title="清空网卡已获取到的ip并重新获取"></a>清空网卡已获取到的ip并重新获取</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr flush eth0 &amp;&amp; dhclient</span><br></pre></td></tr></table></figure><h1 id="lvm"><a href="#lvm" class="headerlink" title="lvm"></a>lvm</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lvextend -l +100%FREE /dev/mapper/debian--vg-root</span><br><span class="line">lvremove /dev/debian-vg/tmp</span><br></pre></td></tr></table></figure><h1 id="ncat"><a href="#ncat" class="headerlink" title="ncat"></a>ncat</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncat -l -k 31280 -c  <span class="string">&#x27;ncat 127.0.0.1 3128&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -l -v 9999 &gt; file.zip</span><br><span class="line">nc -v ip 9999 &lt; file.zip</span><br></pre></td></tr></table></figure><h1 id="log"><a href="#log" class="headerlink" title="log"></a>log</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f manager/`<span class="built_in">date</span> +%Y%m%d`/* service/`<span class="built_in">date</span> +%Y%m%d`/*</span><br></pre></td></tr></table></figure><h1 id="timedatectl"><a href="#timedatectl" class="headerlink" title="timedatectl"></a>timedatectl</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">date</span> -s <span class="string">&quot;2024-05-11 10:12:20&quot;</span></span><br><span class="line"></span><br><span class="line">timedatectl set-time <span class="string">&quot;2024-05-30 12:23:20&quot;</span></span><br><span class="line"></span><br><span class="line">timedatectl set-ntp no</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">好记性不如烂笔头 除非可以复制</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>玩 路由器 之 私人dns</title>
    <link href="https://puzzle9.github.io/posts/9992adb/"/>
    <id>https://puzzle9.github.io/posts/9992adb/</id>
    <published>2024-10-22T06:06:21.000Z</published>
    <updated>2025-05-11T06:12:58.235Z</updated>
    
    <content type="html"><![CDATA[<p>恩 还有点用吧</p><p>之前的那个内存不够 容易重启<br>就搭建了 <code>pve</code> 跑了 <code>openwrt</code></p><p><img src="/posts/9992adb/index.png"></p><h1 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h1><p>方案1: 修改 <code>openwrt</code> 中的 <code>dnsmasq</code> 服务器端口号<br>方案2: 开启 <code>openwrt</code> 中的 <code>dnsmasq</code> 服务器的转发功能</p><p>最终选择了方案1</p><p>这样可以显示出来dns查询的ip</p><h1 id="adguard-安装"><a href="#adguard-安装" class="headerlink" title="adguard 安装"></a>adguard 安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opkg install adguardhome</span><br></pre></td></tr></table></figure><h1 id="adguard-配置"><a href="#adguard-配置" class="headerlink" title="adguard 配置"></a>adguard 配置</h1><h2 id="修改文件保存位置"><a href="#修改文件保存位置" class="headerlink" title="修改文件保存位置"></a>修改文件保存位置</h2><p><code>/etc/config/adguardhome</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">config adguardhome config</span><br><span class="line">option workdir /data/adguardhome</span><br></pre></td></tr></table></figure><h2 id="dns上游"><a href="#dns上游" class="headerlink" title="dns上游"></a>dns上游</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https://dns.alidns.com/dns-query</span><br><span class="line">https://dns.pub/dns-query</span><br><span class="line">223.5.5.5</span><br><span class="line">114.114.114.114</span><br><span class="line">119.29.29.29</span><br><span class="line">2400:3200::1</span><br><span class="line">2402:4e00::</span><br></pre></td></tr></table></figure><h2 id="dns黑名单"><a href="#dns黑名单" class="headerlink" title="dns黑名单"></a>dns黑名单</h2><ul><li><code>easylistchina</code>: <code>https://easylist-downloads.adblockplus.org/easylistchina.txt</code></li><li><code>AdGuard DNS filter mirror</code>: <code>https://raw.gitmirror.com/AdguardTeam/HostlistsRegistry/refs/heads/main/assets/filter_1.txt</code></li></ul><h1 id="openwrt-配置"><a href="#openwrt-配置" class="headerlink" title="openwrt 配置"></a>openwrt 配置</h1><p>用于 修改 openwrt dns端口 无 dns服务器下发</p><p>修改 <code>dhcp</code> 服务器选项 手动下发dns地址 <code>6,192.168.9.1</code></p><p><img src="/posts/9992adb/openwrt_dhcp_setting.png"></p><h1 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h1><ul><li><a href="https://www.right.com.cn/forum/thread-4090928-1-1.html">https://www.right.com.cn/forum/thread-4090928-1-1.html</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;恩 还有点用吧&lt;/p&gt;
&lt;p&gt;之前的那个内存不够 容易重启&lt;br&gt;就搭建了 &lt;code&gt;pve&lt;/code&gt; 跑了 &lt;code&gt;openwrt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/posts/9992adb/index.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;方案</summary>
      
    
    
    
    <category term="路由器" scheme="https://puzzle9.github.io/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
    
  </entry>
  
  <entry>
    <title>玩 路由器 之 openwrt</title>
    <link href="https://puzzle9.github.io/posts/fe6d4e/"/>
    <id>https://puzzle9.github.io/posts/fe6d4e/</id>
    <published>2024-10-22T06:06:20.000Z</published>
    <updated>2025-06-10T14:08:13.235Z</updated>
    
    <content type="html"><![CDATA[<p>恩 这里空空的</p><h1 id="ddns"><a href="#ddns" class="headerlink" title="ddns"></a>ddns</h1><p>嗯 如同字面意思一样</p><p>安装 <code>luci-app-ddns</code> 即可拥有基本功能</p><ul><li><code>ddns-scripts-dnspod</code> 用的 <a href="https://console.dnspod.cn/account/token/token">DNSPod Token</a></li><li><code>ddns-scripts-dnspod-v3</code> 用的 <a href="https://console.cloud.tencent.com/cam/capi">腾讯云 API 密钥</a></li></ul><h1 id="Q-A"><a href="#Q-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><h2 id="版本区别"><a href="#版本区别" class="headerlink" title="版本区别"></a>版本区别</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">generic-ext4-combined-efi.img.gz # 类似于虚拟机磁盘导入 可直接使用</span><br><span class="line">generic-ext4-combined.img.gz</span><br><span class="line">generic-ext4-rootfs.img.gz</span><br><span class="line">generic-kernel.bin</span><br><span class="line">generic-squashfs-combined-efi.img.gz # 类似于iso镜像 需要安装后使用</span><br><span class="line">generic-squashfs-combined.img.gz</span><br><span class="line">generic-squashfs-rootfs.img.gz</span><br><span class="line">rootfs.tar.gz</span><br></pre></td></tr></table></figure><ul><li>efi 带了引导 可以直接启动</li></ul><h2 id="增加pci无线网卡不显示"><a href="#增加pci无线网卡不显示" class="headerlink" title="增加pci无线网卡不显示"></a>增加pci无线网卡不显示</h2><p>安装相应型号驱动 如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opkg install iwlwifi-firmware-ax210</span><br><span class="line">opkg install kmod-iwlwifi</span><br><span class="line">opkg install wpa-supplicant</span><br></pre></td></tr></table></figure><h2 id="多wan-多lan-分开使用"><a href="#多wan-多lan-分开使用" class="headerlink" title="多wan 多lan 分开使用"></a>多wan 多lan 分开使用</h2><p>可以用 mwan3<br>目前只搞定了 ipv4</p><h2 id="lan-口无网络"><a href="#lan-口无网络" class="headerlink" title="lan 口无网络"></a><code>lan</code> 口无网络</h2><p>在 <code>防火墙</code> 中 开启 <code>wan</code> 口的 <code>IP 动态伪装</code></p><h1 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;恩 这里空空的&lt;/p&gt;
&lt;h1 id=&quot;ddns&quot;&gt;&lt;a href=&quot;#ddns&quot; class=&quot;headerlink&quot; title=&quot;ddns&quot;&gt;&lt;/a&gt;ddns&lt;/h1&gt;&lt;p&gt;嗯 如同字面意思一样&lt;/p&gt;
&lt;p&gt;安装 &lt;code&gt;luci-app-ddns&lt;/code&gt;</summary>
      
    
    
    
    
    <category term="OpenWrt" scheme="https://puzzle9.github.io/tags/OpenWrt/"/>
    
  </entry>
  
</feed>

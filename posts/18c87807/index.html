<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:description" content="puzzle9 的博客,还在思考要怎么填充内容."><meta property="og:type" content="website"><meta name="description" content="puzzle9 的博客,还在思考要怎么填充内容."><meta name="keyword" content="puzzle9,博客写点啥"><link rel="shortcut icon" href="/img/favicon.ico"><title>Laravel-Use-Authorization - puzzle9 blog</title><link rel="stylesheet" href="/css/aircloud.css"><link rel="stylesheet" href="/css/gitment.css"><link href="//cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css" rel="stylesheet" type="text/css"><script></script><meta name="google-site-verification" content="3e4j7L_541lS0rJFqZrKpELNNYbwf2-Ed57dT7_dIJA"><script async src="https://www.googletagmanager.com/gtag/js?id=G-BKQDR65NCT"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BKQDR65NCT")</script><meta name="msvalidate.01" content="F41A5465665E7579D1952E516D03A8A7"><meta name="baidu-site-verification" content="code-LrrIDw9dme"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="puzzle9 blog" type="application/atom+xml"></head><body><div class="site-nav-toggle" id="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><div class="index-about"></div><div class="index-container"><div class="index-left"><div class="nav" id="nav"><div class="avatar-name"><div class="avatar"><img src="/img/avatar.jpg"></div><div class="name"><a href="/"><i>puzzle9</i></a></div></div><div class="contents" id="nav-content"><ul><li><a href="/"><i class="bi bi-house"></i> <span>主页</span></a></li><li><a href="/tags"><i class="bi bi-journals"></i> <span>标签</span></a></li><li><a href="/archives"><i class="bi bi-journal-bookmark"></i> <span>存档</span></a></li><li><a href="/about"><i class="bi bi-person"></i> <span>关于</span></a></li><li><a href="/project_plan"><i class="bi bi-file"></i> <span>Project Plan</span></a></li><li><a href="/love_to_do"><i class="bi bi-list-task"></i> <span>Love To Do</span></a></li><li><a id="search"><i class="bi bi-search"></i> <span>搜索</span></a></li></ul></div><div id="toc" class="toc-article"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-text">创建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E8%BE%91-App-Policies-PostPolicy"><span class="toc-text">编辑 App\Policies\PostPolicy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C-App-Providers-Policies"><span class="toc-text">注册 App\Providers\Policies</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Controller%EF%BC%9A"><span class="toc-text">Controller：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blade-%E6%A8%A1%E6%9D%BF%EF%BC%9A"><span class="toc-text">Blade 模板：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User-Model-%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-text">User Model 实例：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#other"><span class="toc-text">other</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BD%95%E4%BC%9A%E6%83%B3%E5%88%B0%E8%BF%99%E4%B8%AA"><span class="toc-text">为何会想到这个</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E8%AE%A4%E8%AF%81%E5%A4%B1%E8%B4%A5%E8%BF%94%E5%9B%9E-403-%E8%80%8C%E4%B8%8D%E6%98%AF-401-%E9%94%99%E8%AF%AF"><span class="toc-text">关于认证失败返回 403 而不是 401 错误</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E6%96%87"><span class="toc-text">原文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%91%E6%96%87"><span class="toc-text">译文</span></a></li></ol></li></ol></li></ol></div></div><div class="search-field" id="search-field"><div class="search-bg" id="search-bg"></div><div class="search-container"><div class="search-input"><span id="esc-search"><i class="bi bi-backspace"></i></span> <input id="search-input"> <span id="begin-search">搜索</span></div><div class="search-result-container" id="search-result-container"></div></div></div><div class="index-about-mobile"><i>I exist because you need me.</i></div></div><div class="index-middle"><div class="post-container"><div class="post-title">Laravel-Use-Authorization</div><div class="post-meta"><span class="attr">发布于：<span>2018-07-25 01:59:13</span></span> <span class="attr">标签：/ <a class="tag" href="/tags/#php" title="php">php</a> <span>/</span> <a class="tag" href="/tags/#Lravel" title="Lravel">Lravel</a> <span>/</span> <a class="tag" href="/tags/#Authorization" title="Authorization">Authorization</a> <span>/</span> </span><span class="attr">访问：<span id="busuanzi_value_page_pv"></span></span></div><div class="post-content no-indent"><blockquote><p>laravel 5.6</p></blockquote><p><a target="_blank" rel="noopener" href="https://laravel.com/docs/5.6/authorization">https://laravel.com/docs/5.6/authorization</a></p><p>只有登陆后才可以判断</p><p>传入的第一个参数必须是 <code>User</code> 模型 第二个字段是自定义内容</p><p>返回值<br><code>true</code> 表示有权限<br><code>false</code> 表示无权限</p><h1 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h1><pre><code>php artisan make:policy PostPolicy --model=User
</code></pre><h1 id="编辑-App-Policies-PostPolicy"><a href="#编辑-App-Policies-PostPolicy" class="headerlink" title="编辑 App\Policies\PostPolicy"></a>编辑 <code>App\Policies\PostPolicy</code></h1><p>默认有 <code>view</code> <code>create</code> <code>update</code> <code>delete</code> 这几种方法</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 在 Policy 中会在所有方法执行前调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">before</span>(<span class="params">User <span class="variable">$user</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment"># code...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">view</span>(<span class="params">User <span class="variable">$user</span>,  <span class="variable">$post</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$user</span>-&gt;id == <span class="variable">$post</span>-&gt;user_id</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="注册-App-Providers-Policies"><a href="#注册-App-Providers-Policies" class="headerlink" title="注册 App\Providers\Policies"></a>注册 <code>App\Providers\Policies</code></h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$policies</span> = [</span><br><span class="line">    <span class="string">&#x27;App\Models\User&#x27;</span> =&gt; <span class="string">&#x27;App\Policies\PostPolicy&#x27;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二种</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">registerPolicies</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Gate</span>::<span class="title function_ invoke__">define</span>(<span class="string">&#x27;checkId&#x27;</span>, function (<span class="variable">$user</span>, <span class="variable">$id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span>-&gt;id == <span class="variable">$id</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Gate</span>::<span class="title function_ invoke__">define</span>(<span class="string">&#x27;update articles&#x27;</span>, <span class="string">&#x27;ArticlePolicy@update&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p><a target="_blank" rel="noopener" href="https://laravel-china.org/articles/5479/the-introduction-of-laravel-authorization-methods-gate-and-policy">https://laravel-china.org/articles/5479/the-introduction-of-laravel-authorization-methods-gate-and-policy</a></p><p>##Gate 门面：</p><pre><code>Gate::allows(&#39;update articles&#39;, $article)
Gate::denies(&#39;update articles&#39;, $article)
</code></pre><h2 id="Controller："><a href="#Controller：" class="headerlink" title="Controller："></a>Controller：</h2><pre><code>$this-&gt;authorize(&#39;update articles&#39;, $article)
</code></pre><h2 id="Blade-模板："><a href="#Blade-模板：" class="headerlink" title="Blade 模板："></a>Blade 模板：</h2><pre><code>@can(&#39;update articles&#39;, $article)
@cannot(&#39;update articles&#39;, $article)
</code></pre><h2 id="User-Model-实例："><a href="#User-Model-实例：" class="headerlink" title="User Model 实例："></a>User Model 实例：</h2><pre><code>$user-&gt;can(&#39;update articles&#39;, $article)
$user-&gt;cannot(&#39;update articles&#39;, $article)
</code></pre><h1 id="other"><a href="#other" class="headerlink" title="other"></a>other</h1><h2 id="为何会想到这个"><a href="#为何会想到这个" class="headerlink" title="为何会想到这个"></a>为何会想到这个</h2><p>源于自己的一个提问 (<a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000015750015">增删改查中如何防止横向越权？</a>)<br>感谢 <a target="_blank" rel="noopener" href="https://segmentfault.com/u/ibrand">ibrand</a> 回答</p><blockquote><p>横向越权操作和纵向越权操作。前者指的是攻击者尝试访问与他拥有相同权限的用户的资源;而后者指的是一个低级别攻击者尝试访问高级别用户的资源。<br><a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/392259649">https://bbs.csdn.net/topics/392259649</a></p></blockquote><blockquote><p>比方说 前端传来一个 id<br>后端进行增删改查<br>如何防止 有效的用户 对 非自己的 资源进行操作<br>在 <code>laravel</code> 中应该把这部分代码放在哪里</p></blockquote><h2 id="关于认证失败返回-403-而不是-401-错误"><a href="#关于认证失败返回-403-而不是-401-错误" class="headerlink" title="关于认证失败返回 403 而不是 401 错误"></a>关于认证失败返回 403 而不是 401 错误</h2><h3 id="原文"><a href="#原文" class="headerlink" title="原文"></a><a target="_blank" rel="noopener" href="http://www.dirv.me/blog/2011/07/18/understanding-403-forbidden/index.html">原文</a></h3><blockquote><p>Understanding 403 Forbidden<br>18 July 2011<br>There’s a problem with 401 Unauthorized, the HTTP status code for authentication errors. And that’s just it: it’s for authentication, not authorization. Receiving a 401 response is the server telling you, “you aren’t authenticated–either not authenticated at all or authenticated incorrectly–but please reauthenticate and try again.” To help you out, it will always include a WWW-Authenticate header that describes how to authenticate.<br>This is a response generally returned by your web server, not your web application.<br>It’s also something very temporary; the server is asking you to try again.<br>So, for authorization I use the 403 Forbidden response. It’s permanent, it’s tied to my application logic, and it’s a more concrete response than a 401.<br>Receiving a 403 response is the server telling you, “I’m sorry. I know who you are–I believe who you say you are–but you just don’t have permission to access this resource. Maybe if you ask the system administrator nicely, you’ll get permission. But please don’t bother me again until your predicament changes.”<br>In summary, a 401 Unauthorized response should be used for missing or bad authentication, and a 403 Forbidden response should be used afterwards, when the user is authenticated but isn’t authorized to perform the requested operation on the given resource.<br>Well that’s my view on it anyway :)</p></blockquote><h3 id="译文"><a href="#译文" class="headerlink" title="译文"></a>译文</h3><blockquote><p>了解403禁止<br>2011年7月18日<br>401 Unauthorized验证错误的HTTP状态代码存在问题。就是这样：它用于身份验证，而不是授权。收到401响应是服务器告诉您，“您未经过身份验证 - 未经过身份验证或未经过身份验证 - 但请重新进行身份验证并重试。”为了帮助您，它将始终包含WWW-Authenticate描述如何进行身份验证。<br>这是您的Web服务器通常返回的响应，而不是您的Web应用程序。<br>这也是非常暂时的; 服务器要求您再试一次。<br>因此，对于授权，我使用403 Forbidden响应。它是永久性的，它与我的应用程序逻辑联系在一起，而且它比401更具体。<br>收到403响应是服务器告诉你，“对不起。我知道你是谁 - 我相信你说的是谁 - 但你只是没有权限访问这个资源。也许如果您很好地询问系统管理员，您将获得许可。但是，在你的困境发生变化之前，请不要再打扰我了。“<br>总之，401 Unauthorized响应应该用于丢失或错误的身份验证，并且403 Forbidden应该在用户经过身份验证但未被授权对给定资源执行请求的操作时使用响应。<br>嗯，这是我对它的看法无论如何:)</p></blockquote><br><div id="comment-container"></div><div id="disqus_thread"></div><div id="lv-container"></div><div class="giscus"></div></div></div></div></div><footer class="footer"><ul class="list-inline text-center"></ul><p><span>/</span> <span><a target="_blank" rel="noopener" href="https://stam1na.gitee.io">Stamina</a></span> <span>/</span></p><p><span>&copy; 2018-2025 <a href="/">puzzle9</a> </span>Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> Theme <a target="_blank" rel="noopener" href="https://github.com/puzzle9/hexo-theme-aircloud-puzzle">AirCloud-puzzle9</a></p><div><span id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv"></span> PV </span><span id="busuanzi_container_site_uv"><span id="busuanzi_value_site_uv"></span> UV</span></div></footer></body><script>window.hexo_search_path="search.json",window.hexo_root="/",window.isPost=!0</script><script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><script src="/js/index.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://giscus.app/client.js" data-repo="puzzle9/puzzle9.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMjI2MjM4NTQ=" data-category="giscus" data-category-id="DIC_kwDOB08Xbs4CRH-Y" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script></html>
<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:description" content="puzzle9 的博客,还在思考要怎么填充内容."><meta property="og:type" content="website"><meta name="description" content="puzzle9 的博客,还在思考要怎么填充内容."><meta name="keyword" content="puzzle9,博客写点啥"><link rel="shortcut icon" href="/img/favicon.ico"><title>Linux Firewall 防火墙 - puzzle9 blog</title><link rel="stylesheet" href="/css/aircloud.css"><link rel="stylesheet" href="/css/gitment.css"><link href="//cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.min.css" rel="stylesheet" type="text/css"><script></script><meta name="google-site-verification" content="3e4j7L_541lS0rJFqZrKpELNNYbwf2-Ed57dT7_dIJA"><script async src="https://www.googletagmanager.com/gtag/js?id=G-BKQDR65NCT"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-BKQDR65NCT")</script><meta name="msvalidate.01" content="F41A5465665E7579D1952E516D03A8A7"><meta name="baidu-site-verification" content="code-LrrIDw9dme"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="puzzle9 blog" type="application/atom+xml"></head><body><div class="site-nav-toggle" id="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><div class="index-about"></div><div class="index-container"><div class="index-left"><div class="nav" id="nav"><div class="avatar-name"><div class="avatar"><img src="/img/avatar.jpg"></div><div class="name"><a href="/"><i>puzzle9</i></a></div></div><div class="contents" id="nav-content"><ul><li><a href="/"><i class="bi bi-house"></i> <span>主页</span></a></li><li><a href="/tags"><i class="bi bi-journals"></i> <span>标签</span></a></li><li><a href="/archives"><i class="bi bi-journal-bookmark"></i> <span>存档</span></a></li><li><a href="/about"><i class="bi bi-person"></i> <span>关于</span></a></li><li><a href="/project_plan"><i class="bi bi-file"></i> <span>Project Plan</span></a></li><li><a href="/love_to_do"><i class="bi bi-list-task"></i> <span>Love To Do</span></a></li><li><a id="search"><i class="bi bi-search"></i> <span>搜索</span></a></li></ul></div><div id="toc" class="toc-article"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#debian-11"><span class="toc-text">debian 11</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">获取当前的配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1"><span class="toc-text">服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3"><span class="toc-text">端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F-Zone"><span class="toc-text">区域 (Zone)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%8C%BA%E5%9F%9F"><span class="toc-text">常用区域</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ping-icmp%E5%8D%8F%E8%AE%AE"><span class="toc-text">ping icmp协议</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">参考</span></a></li></div></div><div class="search-field" id="search-field"><div class="search-bg" id="search-bg"></div><div class="search-container"><div class="search-input"><span id="esc-search"><i class="bi bi-backspace"></i></span> <input id="search-input"> <span id="begin-search">搜索</span></div><div class="search-result-container" id="search-result-container"></div></div></div><div class="index-about-mobile"><i>I exist because you need me.</i></div></div><div class="index-middle"><div class="post-container"><div class="post-title">Linux Firewall 防火墙</div><div class="post-meta"><span class="attr">发布于：<span>2022-07-02 00:43:08</span></span> <span class="attr">标签：/ <a class="tag" href="/tags/#linux" title="linux">linux</a> <span>/</span> </span><span class="attr">访问：<span id="busuanzi_value_page_pv"></span></span></div><div class="post-content no-indent"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><p>在各大主机厂商不懈努力与我们人类以栏作为动力的前提下 这个原生防火墙就变得薄弱起来了</p></blockquote><p>防火墙 按程序字面意思理解就是 规定什么样的数据可以出去 可以进来</p><p>目前采用的是 <code>iptables</code> 和 <code>firewall</code></p><p>然后嘛 由于我觉得我学习 <code>iptables</code> 太过于有难度 便 采用了 <code>firewall</code>了</p><p>当然 这两个是互斥的 都算是封装了命令行 然后交给<code>内核中的netfilter</code>去负责了</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="debian-11"><a href="#debian-11" class="headerlink" title="debian 11"></a>debian 11</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install firewalld</span><br></pre></td></tr></table></figure><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>他有好几个区域 咱们默认以 <code>public</code> 区域开始</p><p>善用 <code>tab</code> 键</p><p>大概主要是这几个大模块 按字面意思晓得就成</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add</span><br><span class="line">firewall-cmd --change</span><br><span class="line">firewall-cmd --get</span><br><span class="line">firewall-cmd --info</span><br><span class="line">firewall-cmd --list</span><br><span class="line">firewall-cmd --query</span><br><span class="line">firewall-cmd --remove</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存 没有此参数 reload 后失效</span></span><br><span class="line">firewall-cmd --permanent</span><br><span class="line"><span class="comment"># 重新载入配置 每次修改后运行后才会生效</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"><span class="comment"># 重启配置 断开已有连接重开</span></span><br><span class="line">firewall-cmd --complete-reload</span><br></pre></td></tr></table></figure><h3 id="获取当前的配置"><a href="#获取当前的配置" class="headerlink" title="获取当前的配置"></a>获取当前的配置</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="built_in">test</span>:~# firewall-cmd --list-all</span><br><span class="line"><span class="comment"># 区域名称</span></span><br><span class="line">public</span><br><span class="line">  target: default</span><br><span class="line">  icmp-block-inversion: no</span><br><span class="line">  interfaces:</span><br><span class="line">  <span class="comment"># 区域 根据不同的区域可以设定 访问 丢弃 等</span></span><br><span class="line">  sources:</span><br><span class="line">  <span class="comment"># 可以访问的服务</span></span><br><span class="line">  services: dhcpv6-client ssh</span><br><span class="line">  <span class="comment"># 可以访问的端口</span></span><br><span class="line">  ports:</span><br><span class="line">  protocols:</span><br><span class="line">  forward: no</span><br><span class="line">  masquerade: no</span><br><span class="line">  forward-ports:</span><br><span class="line">  source-ports:</span><br><span class="line">  icmp-blocks:</span><br><span class="line">  <span class="comment"># 复杂的规则 注意别和 白名单 冲突</span></span><br><span class="line">  rich rules:</span><br></pre></td></tr></table></figure><h3 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可设置服务列表</span></span><br><span class="line">firewall-cmd --get-services</span><br><span class="line"><span class="comment"># 开始让 https 服务对外服务</span></span><br><span class="line">firewall-cmd --permanent --zone=public --add-service=https</span><br><span class="line"><span class="comment"># 停止让 https 服务对外服务</span></span><br><span class="line">firewall-cmd --permanent --zone=public --remove-service=https</span><br></pre></td></tr></table></figure><h3 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询80 tcp 端口是否对外开放</span></span><br><span class="line">firewall-cmd --zone=public --query-port=80/tcp</span><br><span class="line"><span class="comment"># 开始让 80 tcp 端口对外服务</span></span><br><span class="line">firewall-cmd --permanent --zone=public --add-port=80/tcp</span><br><span class="line"><span class="comment"># 停止让 80 tcp 端口对外服务</span></span><br><span class="line">firewall-cmd --permanent --zone=public --remove-port=80/tcp</span><br></pre></td></tr></table></figure><h3 id="区域-Zone"><a href="#区域-Zone" class="headerlink" title="区域 (Zone)"></a>区域 (Zone)</h3><blockquote><p>每个区域对于这种 进出 都有不同的行为</p></blockquote><blockquote><p>源 IP&#x2F;网段 网卡 等 没关联的 就会进入 默认区域 public (匹配规则)</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把 ip 加到 trusted 区域 白名单</span></span><br><span class="line">firewall-cmd --permanent --zone=trusted --add-source=ip</span><br><span class="line"><span class="comment"># 把 ip 移除 trusted 区域 白名单</span></span><br><span class="line">firewall-cmd --permanent --zone=trusted --remove-source=ip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把 ip 加到 drop 区域 拉黑</span></span><br><span class="line">firewall-cmd --permanent --zone=drop --add-source=ip</span><br><span class="line"><span class="comment"># 把 ip 移除 drop 区域 拉黑</span></span><br><span class="line">firewall-cmd --permanent --zone=drop --remove-source=ip</span><br></pre></td></tr></table></figure><h4 id="常用区域"><a href="#常用区域" class="headerlink" title="常用区域"></a>常用区域</h4><ul><li><code>public</code> 公共区域 默认访问的这个区域</li><li><code>block</code> 阻塞区域 全权拒绝 并 告知对方 我拒绝了</li><li><code>drop</code> 丢弃区域 全权拒绝</li><li><code>trusted</code> 信任区域 全权接受</li></ul><h3 id="ping-icmp协议"><a href="#ping-icmp协议" class="headerlink" title="ping icmp协议"></a>ping icmp协议</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启 ping</span></span><br><span class="line">firewall-cmd --permanent --zone=public --remove-icmp-block-inversion</span><br><span class="line"><span class="comment"># 禁止 ping</span></span><br><span class="line">firewall-cmd --permanent --zone=public --add-icmp-block-inversion</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/michael9/p/12092020.html">https://www.cnblogs.com/michael9/p/12092020.html</a></li><li><a target="_blank" rel="noopener" href="https://www.linuxprobe.com/chapter-08.html">https://www.linuxprobe.com/chapter-08.html</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/jnloverll/article/details/120333488">https://blog.csdn.net/jnloverll/article/details/120333488</a></li><li><a target="_blank" rel="noopener" href="https://teddysun.com/566.html">https://teddysun.com/566.html</a></li><li><a target="_blank" rel="noopener" href="https://linux.cn/article-9073-1.html">https://linux.cn/article-9073-1.html</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/408456570">https://zhuanlan.zhihu.com/p/408456570</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_31649693/article/details/120840038">https://blog.csdn.net/qq_31649693/article/details/120840038</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/avatar_2009/article/details/112512819">https://blog.csdn.net/avatar_2009/article/details/112512819</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40902244/article/details/123731140">https://blog.csdn.net/weixin_40902244/article/details/123731140</a></li></ul><br><div id="comment-container"></div><div id="disqus_thread"></div><div id="lv-container"></div><div class="giscus"></div></div></div></div></div><footer class="footer"><ul class="list-inline text-center"></ul><p><span>/</span> <span><a target="_blank" rel="noopener" href="https://stam1na.gitee.io">Stamina</a></span> <span>/</span></p><p><span>&copy; 2018-2025 <a href="/">puzzle9</a> </span>Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> Theme <a target="_blank" rel="noopener" href="https://github.com/puzzle9/hexo-theme-aircloud-puzzle">AirCloud-puzzle9</a></p><div><span id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv"></span> PV </span><span id="busuanzi_container_site_uv"><span id="busuanzi_value_site_uv"></span> UV</span></div></footer></body><script>window.hexo_search_path="search.json",window.hexo_root="/",window.isPost=!0</script><script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><script src="/js/index.js"></script><script async src="https://busuanzi.icodeq.com/busuanzi.pure.mini.js"></script><script src="https://giscus.app/client.js" data-repo="puzzle9/puzzle9.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMjI2MjM4NTQ=" data-category="giscus" data-category-id="DIC_kwDOB08Xbs4CRH-Y" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script></html>